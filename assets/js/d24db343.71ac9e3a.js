"use strict";(self.webpackChunkstsinc_docs=self.webpackChunkstsinc_docs||[]).push([[7780],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=a.createContext({}),c=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},s=function(e){var t=c(e.components);return a.createElement(i.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},f=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,s=p(e,["components","mdxType","originalType","parentName"]),u=c(n),f=r,m=u["".concat(i,".").concat(f)]||u[f]||d[f]||o;return n?a.createElement(m,l(l({ref:t},s),{},{components:n})):a.createElement(m,l({ref:t},s))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,l=new Array(o);l[0]=f;var p={};for(var i in t)hasOwnProperty.call(t,i)&&(p[i]=t[i]);p.originalType=e,p[u]="string"==typeof e?e:r,l[1]=p;for(var c=2;c<o;c++)l[c]=n[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}f.displayName="MDXCreateElement"},8511:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>d,frontMatter:()=>o,metadata:()=>p,toc:()=>c});var a=n(7462),r=(n(7294),n(3905));const o={},l=void 0,p={unversionedId:"\u8d22\u52a1\u5b9e\u6218/\u53d1\u7968\u91d1\u989d\u7684\u56db\u820d\u4e94\u5165\u5904\u7406",id:"\u8d22\u52a1\u5b9e\u6218/\u53d1\u7968\u91d1\u989d\u7684\u56db\u820d\u4e94\u5165\u5904\u7406",title:"\u53d1\u7968\u91d1\u989d\u7684\u56db\u820d\u4e94\u5165\u5904\u7406",description:"\u767c\u7968\u91d1\u984d\u7684\u56db\u6368\u4e94\u5165",source:"@site/best-practice/100. \u8d22\u52a1\u5b9e\u6218/10. \u53d1\u7968\u91d1\u989d\u7684\u56db\u820d\u4e94\u5165\u5904\u7406.md",sourceDirName:"100. \u8d22\u52a1\u5b9e\u6218",slug:"/\u8d22\u52a1\u5b9e\u6218/\u53d1\u7968\u91d1\u989d\u7684\u56db\u820d\u4e94\u5165\u5904\u7406",permalink:"/best-practice/\u8d22\u52a1\u5b9e\u6218/\u53d1\u7968\u91d1\u989d\u7684\u56db\u820d\u4e94\u5165\u5904\u7406",draft:!1,tags:[],version:"current",sidebarPosition:10,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u4f1a\u8ba1\u79d1\u76ee\u7684\u672c\u5730\u5316",permalink:"/best-practice/\u8d22\u52a1\u5b9e\u6218/\u5173\u4e8e\u4f1a\u8ba1\u79d1\u76ee\u672c\u5730\u5316"},next:{title:"\u81ea\u5b9a\u4e49\u635f\u76ca\u8868",permalink:"/best-practice/\u8d22\u52a1\u5b9e\u6218/\u81ea\u5b9a\u4e49\u635f\u76ca\u8868"}},i={},c=[{value:"\u767c\u7968\u91d1\u984d\u7684\u56db\u6368\u4e94\u5165",id:"\u767c\u7968\u91d1\u984d\u7684\u56db\u6368\u4e94\u5165",level:2},{value:"1. \u8a2d\u5b9a Regional",id:"1-\u8a2d\u5b9a-regional",level:4},{value:"2. \u8a2d\u5b9a Precision",id:"2-\u8a2d\u5b9a-precision",level:4},{value:"3. \u65b0\u589e\u6b04\u4f4d\u5b58\u653e\u81ea\u884c\u8a08\u7b97\u7684\u91d1\u984d\u8207\u7a05\u8cbb",id:"3-\u65b0\u589e\u6b04\u4f4d\u5b58\u653e\u81ea\u884c\u8a08\u7b97\u7684\u91d1\u984d\u8207\u7a05\u8cbb",level:4},{value:"Python \u7684\u5c0f\u6578\u9ede\u9032\u4f4d",id:"python-\u7684\u5c0f\u6578\u9ede\u9032\u4f4d",level:2},{value:"Cache \u7684\u61c9\u7528",id:"cache-\u7684\u61c9\u7528",level:2},{value:"www \u4e0b\u7684\u9801\u9762",id:"www-\u4e0b\u7684\u9801\u9762",level:2},{value:"No Module Named bz2",id:"no-module-named-bz2",level:3},{value:"Step1.",id:"step1",level:4},{value:"Step2.",id:"step2",level:4},{value:"Form Script \u6c92\u6709\u985e\u4f3c hooks.py \u4e2d\u7684 on_update_after_submit \u7684\u4e8b\u4ef6",id:"form-script-\u6c92\u6709\u985e\u4f3c-hookspy-\u4e2d\u7684-on_update_after_submit-\u7684\u4e8b\u4ef6",level:2}],s={toc:c},u="wrapper";function d(e){let{components:t,...n}=e;return(0,r.kt)(u,(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"\u767c\u7968\u91d1\u984d\u7684\u56db\u6368\u4e94\u5165"},"\u767c\u7968\u91d1\u984d\u7684\u56db\u6368\u4e94\u5165"),(0,r.kt)("p",null,"\u6587\u7ae0\u6765\u6e90\uff1a ",(0,r.kt)("a",{parentName:"p",href:"https://hackmd.io/@Lin301046/Sye2ylCKY"},"https://hackmd.io/@Lin301046/Sye2ylCKY")),(0,r.kt)("p",null,"\u7531\u65bc\u53f0\u7063\u7684\u767c\u7968\u91d1\u984d\uff0c\u7a05\u8cbb\u7b49\u90fd\u662f\u6574\u6578\uff0c\u800c ERPNext \u7684\u91d1\u984d\u9810\u8a2d\u90fd\u6703\u6709\u5c0f\u6578\u9ede\uff0c\u56e0\u6b64\u9700\u8981\u900f\u904e\u4e00\u4e9b\u8a2d\u5b9a\u4f86\u8b93 ERPNext \u5728\u8a08\u7b97\u6642\u5c07\u91d1\u984d\u8207\u7a05\u8cbb\u6642\u81ea\u884c\u56db\u6368\u4e94\u5165\uff0c\u4ee5\u7b26\u5408\u53f0\u7063\u7684\u4f7f\u7528\u7fd2\u6163\u3002"),(0,r.kt)("h4",{id:"1-\u8a2d\u5b9a-regional"},"1. \u8a2d\u5b9a Regional"),(0,r.kt)("p",null,"ERPNext \u6703\u6839\u64da\u7576\u524d\u7684\u5340\u57df\uff0c\u82e5\u70ba\u7279\u5730\u5340\u57df\u6703\u6709\u4e0d\u4e00\u6a23\u7684\u91d1\u984d\u8a08\u7b97\u65b9\u5f0f(",(0,r.kt)("a",{parentName:"p",href:"https://github.com/frappe/erpnext/blob/version-13/erpnext/hooks.py#L447"},"ERPNext \u7684 Regionl \u8a2d\u5b9a"),")\uff0c\u56e0\u6b64\u6211\u5011\u53ef\u4ee5\u6309\u7167 ERPNext \u7684\u505a\u6cd5\uff0c\u5728 ",(0,r.kt)("a",{parentName:"p",href:"http://hooks.py/"},"hooks.py")," \u4e2d\u65b0\u589e\u4e00\u500b Taiwan\uff0c\u4e26\u4e14\u8a2d\u5b9a\u8981 Override \u7684 method\uff0c\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# hooks.py\nregional_overrides = {\n    'Taiwan': {\n        'erpnext.controllers.taxes_and_totals.get_regional_round_off_accounts': 'my_app.utils.get_regional_round_off_accounts'\n    }\n}\n\n# my_app.utils.get_regional_round_off_accounts\ndef get_regional_round_off_accounts(company, account_list):\n    frappe.flags.round_off_applicable_accounts = [\"2161 - \u61c9\u4ed8\u6240\u5f97\u7a05 - Company\", \"VAT - Company\"]\n    return frappe.flags.round_off_applicable_accounts\n")),(0,r.kt)("p",null,"get_regional_round_off_accounts \u4e2d\uff0c\u82e5 accounts \u7684 name \u5b58\u5728\u65bc frappe.flags.round_off_applicable_accounts \u4e2d\uff0c\u91d1\u984d\u4fbf\u6703\u56db\u6368\u4e94\u5165\uff0c\u56e0\u6b64\u53ef\u4ee5\u5c07\u9700\u8981\u56db\u6368\u4e94\u5165\u7684 accounts \u653e\u5165 round_off_applicable_accounts\uff0c\u5982\u6b64\u4e00\u4f86\u5728\u8a08\u7b97\u7279\u5b9a accounts \u7684\u91d1\u984d\u6642\uff0c\u4fbf\u90fd\u6703\u56db\u6368\u4e94\u5165\u4e86"),(0,r.kt)("h4",{id:"2-\u8a2d\u5b9a-precision"},"2. \u8a2d\u5b9a Precision"),(0,r.kt)("p",null,"\u82e5\u5c07 doctype \u4e2d\u7684\u6307\u5b9a\u6b04\u4f4d\u7cbe\u5ea6\u8a2d\u70ba 0\uff0c\u4f8b\u5982 total\u3001amount\u2026 \u4e5f\u6703\u6709\u4e00\u6a23\u7684\u6548\u679c\u3002\n\u9019\u90e8\u5206\u53ef\u4ee5\u5229\u7528 patch \u7684\u65b9\u5f0f\uff0c\u4e26\u4e14\u900f\u904e bench migrate \u53bb\u8655\u7406\uff0c\u4fbf\u4e0d\u7528\u6bcf\u63db\u4e00\u500b\u74b0\u5883\u90fd\u9700\u8981\u7279\u5730\u53bb\u57f7\u884c\u4e00\u500b SQL\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"frappe.db.sql(f\"\"\"\n    UPDATE `tabDocField` SET `precision` = 0 \n    WHERE fieldname IN ('amount', 'base_amount', 'total', 'base_total', 'grand_total', 'base_grand_total', 'net_total', 'base_net_total', 'taxes_and_charges', 'base_taxes_and_charges', 'total_taxes_and_charges') \n    AND (parent like 'Purchase%' or parent like 'Delivery%' or parent like 'Sales%' or parent like 'Advance%') \n    AND fieldtype = 'Currency';\n\"\"\")\n")),(0,r.kt)("h4",{id:"3-\u65b0\u589e\u6b04\u4f4d\u5b58\u653e\u81ea\u884c\u8a08\u7b97\u7684\u91d1\u984d\u8207\u7a05\u8cbb"},"3. \u65b0\u589e\u6b04\u4f4d\u5b58\u653e\u81ea\u884c\u8a08\u7b97\u7684\u91d1\u984d\u8207\u7a05\u8cbb"),(0,r.kt)("p",null,"\u96d6\u7136\u900f\u904e\u524d\u5169\u500b\u65b9\u6cd5\uff0c\u53ef\u4ee5\u8b93\u91d1\u984d\u8207\u7a05\u8cbb\u90fd\u56db\u6368\u4e94\u5165\uff0c\u4f46\u662f\u4e0a\u8ff0\u5169\u500b\u65b9\u6cd5\u5728\u672a\u7a05\u984d\u7684\u8a08\u7b97\u4e26\u4e0d\u6703\u8d77\u4f5c\u7528\uff0c\u56e0\u70ba ERPNext \u7684\u672a\u7a05\u984d\u662f\u4f7f\u7528\u542b\u7a05\u984d\u53bb\u56de\u63a8\u7684\uff0c\u52e2\u5fc5\u4e00\u5b9a\u6703\u51fa\u73fe\u5c0f\u6578\u9ede\uff0c\u800c\u524d\u9762\u6709\u63d0\u5230\uff0c\u53f0\u7063\u7684\u91d1\u984d\u8207\u7a05\u8cbb\u57fa\u672c\u4e0a\u90fd\u662f\u6574\u6578\uff0c\u6211\u5011\u7684\u5ba2\u6236\u5c0d\u65bc\u9019\u90e8\u5206\u4e5f\u6709\u7279\u5225\u8981\u6c42\u4e00\u5b9a\u8981\u6574\u6578\uff0c\u56e0\u6b64\u5728\u7522\u51fa\u5831\u8868\u6642\uff0c\u6b64\u60c5\u6cc1\u5c31\u5f88\u5bb9\u6613\u56e0\u70ba\u56db\u6368\u4e94\u5165\u7684\u95dc\u4fc2\u800c\u51fa\u73fe\u4e9b\u5fae\u7684\u8aa4\u5dee\uff0c\u56e0\u6b64\u70ba\u4e86\u518d\u4e0d\u5f71\u97ff ERPNext \u904b\u4f5c\u7684\u524d\u63d0\u4e0b\u8655\u7406\u9019\u500b\u554f\u984c\uff0c\u6211\u5011\u9078\u64c7\u81ea\u884c\u65b0\u589e\u6b04\u4f4d\uff0c\u4e26\u4e14\u5229\u7528 Frappe \u7684 DocEvent\uff0c\u7576\u767c\u7968\u65b0\u589e\u524d(before_insert)\u6216\u66f4\u65b0\u524d(before_save)\u6642\uff0c\u5148\u4f9d\u7167\u6211\u5011\u7684\u9700\u6c42\u53bb\u8a08\u7b97\u672a\u7a05\u984d\u8207\u7a05\u984d\uff0c\u4e4b\u5f8c\u7684\u5831\u8868\u5982\u679c\u6709\u9700\u8981\u6293\u672a\u7a05\u984d\u7684\u8cc7\u8a0a\u6642\uff0c\u90fd\u6293\u9019\u500b\u6211\u5011\u81ea\u884c\u65b0\u589e\u7684\u6b04\u4f4d\uff0c\u5982\u6b64\u4fbf\u80fd\u518d\u4e0d\u5f71\u97ff\u7cfb\u7d71\u904b\u4f5c\u7684\u524d\u63d0\u4e0b\u8655\u7406\u597d\u9019\u500b\u554f\u984c\u3002"),(0,r.kt)("h2",{id:"python-\u7684\u5c0f\u6578\u9ede\u9032\u4f4d"},"Python \u7684\u5c0f\u6578\u9ede\u9032\u4f4d"),(0,r.kt)("p",null,"\u7531\u65bc\u6d6e\u9ede\u6578\u5728\u96fb\u8166\u4e2d\u662f\u7528\u975e\u5e38\u8fd1\u4f3c\u7684\u4e00\u500b\u6578\u5b57\u53bb\u8868\u9054\uff0c\u4f8b\u5982 1.5 \u53ef\u80fd\u6703\u8868\u9054\u70ba 1.499999999\uff0c\u9019\u500b\u8868\u9054\u65b9\u5f0f\u5728\u67d0\u4e9b\u6578\u5b57\u7684\u9032\u4f4d\u6642\uff0c\u53ef\u80fd\u5c31\u6703\u51fa\u73fe\u9032\u4f4d\u932f\u8aa4\u7684\u60c5\u6cc1\n\u4f8b\u5982\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"round(8.125, 2) # 8.12\nround(8.135, 2) # 8.13\n")),(0,r.kt)("p",null,"8.125 \u56db\u6368\u4e94\u5165\u5230\u5c0f\u6578\u9ede\u7b2c\u4e8c\u4f4d\u61c9\u8a72\u8981\u662f 8.13\uff0c8.135 \u5247\u61c9\u8a72\u8981\u662f 8.14\uff0c\u4f46\u662f Python \u5167\u5efa\u7684 round\uff0c\u537b\u5206\u5225\u6703\u662f 8.12 \u8207 8.13\uff0c\u56e0\u6b64\u70ba\u4e86\u89e3\u6c7a\u9019\u500b\u554f\u984c\uff0c\u5efa\u8b70\u4ee5\u4e0b\u7684\u65b9\u5f0f\u53bb\u8655\u7406\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"from frappe.utils.data import flt\n\nflt(8.125, 2) # 8.13\nflt(8.135, 2) # 8.14\n")),(0,r.kt)("p",null,"\u4f7f\u7528 Frappe \u5167\u5efa\u7684 flt \u53bb\u8655\u7406\u9032\u4f4d\uff0c\u4fbf\u4e0d\u6703\u767c\u751f\u9019\u7a2e\u932f\u8aa4\u4e86\u3002"),(0,r.kt)("h2",{id:"cache-\u7684\u61c9\u7528"},"Cache \u7684\u61c9\u7528"),(0,r.kt)("p",null,"Frappe \u5df2\u7d93\u6709\u5167\u5efa\u7684 cache \u80fd\u7528\uff0c\u8a72 cache \u662f\u57fa\u65bc Redis \u6240\u5efa\u7acb\u7684\u800c\u6210\u7684\uff0c\u5728\u7522\u751f\u4e00\u4e9b\u5927\u578b\u7684\u5831\u8868\u6642\uff0c\u53ef\u4ee5\u5c07\u67d0\u4e9b\u7d50\u679c\u5148\u5b58\u653e\u65bc Cache \u4e2d\uff0c\u4ee5\u52a0\u5feb\u57f7\u884c\u7684\u901f\u5ea6\u3002"),(0,r.kt)("p",null,"Frappe Cache \u7684\u4f7f\u7528\u65b9\u6cd5\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'import frappe \n\ncache = frappe.cache()\n\n# \u8a2d\u5b9a\u4e00\u500b\u5feb\u53d6 \u5feb\u53d6\u7684 Key \u70ba Cache Key , \u503c\u70ba Cache Value\n# 3600 \u79d2\u5f8c\u904e\u671f\ncache.set_value("Cache Key", "Cache Value", expires_in_sec=3600)\n\n# \u56de\u50b3 Cache Key \u7684 Value \u4e26\u4e14\u4e0d\u6703\u5c07\u8a72\u503c\u5b58\u5728 frappe.local \u4e2d\n# \u82e5\u627e\u4e0d\u5230 Cache \u5247\u56de\u50b3 None\ncache.get_value(cache_key, expires=True)\n')),(0,r.kt)("h2",{id:"www-\u4e0b\u7684\u9801\u9762"},"www \u4e0b\u7684\u9801\u9762"),(0,r.kt)("p",null,"\u5728\u81ea\u5b9a\u7fa9\u7684\u6a21\u7d44\u4e0b\uff0c\u53ef\u4ee5\u6309\u7167\u4e0b\u5716\u7684\u65b9\u5f0f\u53bb\u653e\n",(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/lkz00oB.png",alt:"img"})),(0,r.kt)("p",null,"\u9019\u6a23\u5b50\u5c31\u53ef\u4ee5\u900f\u904e ",(0,r.kt)("a",{parentName:"p",href:"http://127.0.0.1/sales_invoic"},"http://127.0.0.1/sales_invoic")," \u9019\u500b URL \u9032\u5165 index.html\uff0c\u800c\u5728\u9032\u5165 index.html \u524d\uff0cFrappe \u6703\u5148\u57f7\u884c ",(0,r.kt)("a",{parentName:"p",href:"http://index.py/"},"index.py"),"\uff0c\u8a72 ",(0,r.kt)("a",{parentName:"p",href:"http://index.py/"},"index.py")," \u4e2d\u6703\u9700\u8981\u4e00\u500b\u53eb\u505a get_context(context) \u7684 method\uff0c\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# index.py\ndef get_context(context):\n    context.test = 'Hello World'\n<html>\n    <body>\n        \x3c!-- context \u4e2d\u6240\u8a2d\u5b9a\u7684 Hello World \u6703\u88ab\u6e32\u67d3\u5230\u756b\u9762\u4e0a --\x3e\n        {{ test }}\n    </body>\n</html>\n")),(0,r.kt)("p",null,"\u9019\u500b context \u6703\u88ab\u50b3\u5230 index.html \u4e2d\uff0c\u4e26\u4e14\u53ef\u5229\u7528 jinja \u7684\u8a9e\u6cd5\u4f86\u9032\u884c\u4f7f\u7528\uff0c\u56e0\u6b64\u53ef\u4ee5\u4f9d\u7167\u9700\u6c42\u5c07\u9700\u8981\u7684\u8cc7\u6599\u653e\u5165 context \u4ee5\u5448\u73fe\u4e0d\u4e00\u6a23\u7684\u8cc7\u8a0a\u3002"),(0,r.kt)("h3",{id:"no-module-named-bz2"},"No Module Named bz2"),(0,r.kt)("p",null,"\u5b89\u88dd frappe docker \u6642\uff0c\u6709\u53ef\u80fd\u6703\u56e0\u70ba\u4e00\u958b\u59cb\u7de8\u8b6f\u7684 python \u5c11\u4e86 libbz2-dev \u7684\u95dc\u4fc2\uff0c\u4f7f\u5f97 import pandas \u6642\uff0c\u6703\u767c\u751f No Module Named bz2 \u7684\u932f\u8aa4\uff0c\u76ee\u524d\u5be6\u6e2c\u904e\u5f8c\u4e3b\u8981\u89e3\u6c7a\u65b9\u5f0f\u70ba\u5b89\u88dd libbz2-dev \u5f8c\u91cd\u65b0 build Python \u5373\u53ef\u89e3\u6c7a\u3002"),(0,r.kt)("p",null,"\u7531\u65bc Frappe Docker \u4e2d\u6709\u5167\u5efa pyenv\uff0c\u56e0\u6b64\u53ef\u4ee5\u53c3\u8003\u6b64\u7db2\u7ad9\u7684\u505a\u6cd5\u9032\u884c\n(",(0,r.kt)("a",{parentName:"p",href:"https://realpython.com/intro-to-pyenv/#build-dependencies"},"https://realpython.com/intro-to-pyenv/#build-dependencies"),")"),(0,r.kt)("h4",{id:"step1"},"Step1."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo apt-get install -y make build-essential libssl-dev zlib1g-dev \\\nlibbz2-dev libreadline-dev libsqlite3-dev wget curl llvm libncurses5-dev \\\nlibncursesw5-dev xz-utils tk-dev libffi-dev liblzma-dev\n")),(0,r.kt)("h4",{id:"step2"},"Step2."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"pyenv install -v <Python Version>\n")),(0,r.kt)("p",null,"\u91cd\u65b0\u5b89\u88dd\u5b8c\u4e4b\u5f8c\uff0c\u5728\u5b89\u88dd\u4e00\u6b21 pandas \u4e26\u4e14 import\uff0c\u554f\u984c\u57fa\u672c\u4e0a\u5c31\u53ef\u4ee5\u89e3\u6c7a\u4e86\u3002"),(0,r.kt)("h2",{id:"form-script-\u6c92\u6709\u985e\u4f3c-hookspy-\u4e2d\u7684-on_update_after_submit-\u7684\u4e8b\u4ef6"},"Form Script \u6c92\u6709\u985e\u4f3c ",(0,r.kt)("a",{parentName:"h2",href:"http://hooks.py/"},"hooks.py")," \u4e2d\u7684 on_update_after_submit \u7684\u4e8b\u4ef6"),(0,r.kt)("p",null,"\u7531\u65bc doc \u5728\u63d0\u4ea4\u5f8c\uff0c\u82e5\u8981\u66f4\u65b0\u8cc7\u6599\uff0cfrappe \u7684 form script \u4e26\u6c92\u6709\u50cf\u5f8c\u7aef\u90a3\u6a23\u6709 on_update_after_submit \u7684\u4e8b\u4ef6\u53ef\u4ee5\u547c\u53eb\uff0c\u56e0\u6b64\u7121\u6cd5\u5c0d\u63d0\u4ea4\u5f8c\u7684\u8868\u55ae\u5728\u66f4\u65b0\u524d\u4f7f\u7528 JS \u9032\u884c\u8cc7\u6599\u524d\u8655\u7406\uff0c\u89e3\u6c7a\u65b9\u6cd5\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'validate_and_save(save_action, callback, btn, on_error, resolve, reject) {\n        var me = this;\n        if(!save_action) save_action = "Save";\n        this.validate_form_action(save_action, resolve);\n\n        var after_save = function(r) {\n            // to remove hash from URL to avoid scroll after save\n            history.replaceState(null, null, \' \');\n            if(!r.exc) {\n                if (["Save", "Update", "Amend"].indexOf(save_action)!==-1) {\n                    frappe.utils.play_sound("click");\n                }\n\n                me.script_manager.trigger("after_save");\n\n                if (frappe.route_hooks.after_save) {\n                    let route_callback = frappe.route_hooks.after_save;\n                    delete frappe.route_hooks.after_save;\n\n                    route_callback(me);\n                }\n                // submit comment if entered\n                if (me.comment_box) {\n                    me.comment_box.submit();\n                }\n                me.refresh();\n            } else {\n                if(on_error) {\n                    on_error();\n                    reject();\n                }\n            }\n            callback && callback(r);\n            resolve();\n        };\n\n        var fail = (e) => {\n            if (e) {\n                console.error(e)\n            }\n            btn && $(btn).prop("disabled", false);\n            if(on_error) {\n                on_error();\n                reject();\n            }\n        };\n\n        if(save_action != "Update") {\n            // validate\n            frappe.validated = true;\n            frappe.run_serially([\n                () => this.script_manager.trigger("validate"),\n                () => this.script_manager.trigger("before_save"),\n                () => {\n                    if(!frappe.validated) {\n                        fail();\n                        return;\n                    }\n\n                    frappe.ui.form.save(me, save_action, after_save, btn);\n                }\n            ]).catch(fail);\n        } else {\n            // \u4fee\u6539\u6b64\u8655\u7684\u539f\u59cb\u78bc\n            // https://github.com/frappe/frappe/blob/version-13/frappe/public/js/frappe/form/form.js#L689\n            frappe.run_serially([\n                () => this.script_manager.trigger("on_update_after_submit"),\n                () => frappe.ui.form.save(me, save_action, after_save, btn)\n            ]).catch(fail)\n        }\n    }\n')))}d.isMDXComponent=!0}}]);