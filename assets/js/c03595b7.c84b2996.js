"use strict";(self.webpackChunkstsinc_docs=self.webpackChunkstsinc_docs||[]).push([[8473],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>k});var a=n(7294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var p=a.createContext({}),d=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},s=function(e){var t=d(e.components);return a.createElement(p.Provider,{value:t},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,r=e.originalType,p=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),u=d(n),m=l,k=u["".concat(p,".").concat(m)]||u[m]||c[m]||r;return n?a.createElement(k,i(i({ref:t},s),{},{components:n})):a.createElement(k,i({ref:t},s))}));function k(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=n.length,i=new Array(r);i[0]=m;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o[u]="string"==typeof e?e:l,i[1]=o;for(var d=2;d<r;d++)i[d]=n[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},6288:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>c,frontMatter:()=>r,metadata:()=>o,toc:()=>d});var a=n(7462),l=(n(7294),n(3905));const r={},i="Server Side",o={unversionedId:"\u5e94\u7528\u5f00\u53d1/\u5f00\u53d1API\u624b\u518c",id:"\u5e94\u7528\u5f00\u53d1/\u5f00\u53d1API\u624b\u518c",title:"Server Side",description:"https://github.com/frappe/frappe/wiki/Developer-Cheatsheet",source:"@site/best-practice/20. \u5e94\u7528\u5f00\u53d1/50. \u5f00\u53d1API\u624b\u518c.md",sourceDirName:"20. \u5e94\u7528\u5f00\u53d1",slug:"/\u5e94\u7528\u5f00\u53d1/\u5f00\u53d1API\u624b\u518c",permalink:"/best-practice/\u5e94\u7528\u5f00\u53d1/\u5f00\u53d1API\u624b\u518c",draft:!1,tags:[],version:"current",sidebarPosition:50,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u5982\u4f55\u8bbe\u5b9a\u4efb\u52a1\u8ba1\u5212",permalink:"/best-practice/\u5e94\u7528\u5f00\u53d1/\u5982\u4f55\u8bbe\u5b9a\u4efb\u52a1\u8ba1\u5212"},next:{title:"OCR \u8bc6\u522b\u7279\u522b\u6ce8\u610f",permalink:"/best-practice/\u5e94\u7528\u5f00\u53d1/OCR \u8bc6\u522b\u7279\u522b\u6ce8\u610f"}},p={},d=[{value:"frappe module",id:"frappe-module",level:3},{value:"<code>frappe.form_dict</code>",id:"frappeform_dict",level:6},{value:"<code>frappe.get_doc(doctype, name)</code>",id:"frappeget_docdoctype-name",level:6},{value:"<code>frappe.get_meta(doctype)</code>",id:"frappeget_metadoctype",level:6},{value:"<code>frappe.get_all(doctype, filters, fields)</code>",id:"frappeget_alldoctype-filters-fields",level:6},{value:"<code>frappe.get_list(doctype, filters, fields, order_by)</code>",id:"frappeget_listdoctype-filters-fields-order_by",level:6},{value:"<code>frappe.get_value(doctype, name, fieldname)</code>",id:"frappeget_valuedoctype-name-fieldname",level:6},{value:"<code>frappe.get_last_doc(doctype)</code>",id:"frappeget_last_docdoctype",level:6},{value:"<code>frappe.get_single(doctype)</code>",id:"frappeget_singledoctype",level:6},{value:"<code>frappe.get_installed_apps()</code>",id:"frappeget_installed_apps",level:6},{value:"Document Object",id:"document-object",level:2},{value:"Load a document",id:"load-a-document",level:5},{value:"Insert a new doc",id:"insert-a-new-doc",level:3},{value:"How to make public API",id:"how-to-make-public-api",level:3},{value:"Syntax Error",id:"syntax-error",level:3},{value:"Desk",id:"desk",level:2},{value:"Globals",id:"globals",level:4},{value:"Routing",id:"routing",level:4},{value:"Route Options",id:"route-options",level:5},{value:"Forms",id:"forms",level:2},{value:"1. To add a new handler on value change.",id:"1-to-add-a-new-handler-on-value-change",level:3},{value:"List of Triggers",id:"list-of-triggers",level:4},{value:"Child Table Triggers",id:"child-table-triggers",level:4},{value:"2. Adding Standard JS Listeners to form fields",id:"2-adding-standard-js-listeners-to-form-fields",level:3},{value:"3. Change value in the form",id:"3-change-value-in-the-form",level:3},{value:"4. Talk to the database",id:"4-talk-to-the-database",level:3},{value:"5. Add a new row to a child table",id:"5-add-a-new-row-to-a-child-table",level:3},{value:"Filter link options in a child table",id:"filter-link-options-in-a-child-table",level:3},{value:"Running Tasks Serially",id:"running-tasks-serially",level:2},{value:"Tests",id:"tests",level:2},{value:"Utility",id:"utility",level:2}],s={toc:d},u="wrapper";function c(e){let{components:t,...n}=e;return(0,l.kt)(u,(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"server-side"},"Server Side"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://github.com/frappe/frappe/wiki/Developer-Cheatsheet"},"https://github.com/frappe/frappe/wiki/Developer-Cheatsheet")),(0,l.kt)("h3",{id:"frappe-module"},"frappe module"),(0,l.kt)("h6",{id:"frappeform_dict"},(0,l.kt)("inlineCode",{parentName:"h6"},"frappe.form_dict")),(0,l.kt)("p",null,"Request parameters"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},"Form Dict: {'doctype': 'FIN Report Def', 'company': 'DTY007', 'is_group': '1', 'item_name': 'test003', 'parent': '\u6d41\u52a8\u8d44\u4ea7', 'is_root': 'false', 'cmd': 'erpnextcn.fin.doctype.fin_report_def.fin_report_def.add_rc'}\n")),(0,l.kt)("h6",{id:"frappeget_docdoctype-name"},(0,l.kt)("inlineCode",{parentName:"h6"},"frappe.get_doc(doctype, name)")),(0,l.kt)("p",null,"e.g. frappe.get_doc('Project', 'My Project')"),(0,l.kt)("p",null,"Load a document from the database with give doctype (table) and name Returns a Document object. All columns are properties. e.g. doc.name"),(0,l.kt)("h6",{id:"frappeget_metadoctype"},(0,l.kt)("inlineCode",{parentName:"h6"},"frappe.get_meta(doctype)")),(0,l.kt)("p",null,"Loads the metadata (DocType) of the given doctype."),(0,l.kt)("p",null,"e.g. ",(0,l.kt)("inlineCode",{parentName:"p"},"frappe.get_meta('Task').fields")," is the list of fields in Task doctype"),(0,l.kt)("h6",{id:"frappeget_alldoctype-filters-fields"},(0,l.kt)("inlineCode",{parentName:"h6"},"frappe.get_all(doctype, filters, fields)")),(0,l.kt)("p",null,"e.g. ",(0,l.kt)("inlineCode",{parentName:"p"},"frappe.get_all('Project', filters={'status': 'Open'}, fields=['name', 'description'])")),(0,l.kt)("p",null,"Returns a list of dict objects from the database"),(0,l.kt)("h6",{id:"frappeget_listdoctype-filters-fields-order_by"},(0,l.kt)("inlineCode",{parentName:"h6"},"frappe.get_list(doctype, filters, fields, order_by)")),(0,l.kt)("p",null,"Sames as frappe.get_all, but will only show records permitted for the user"),(0,l.kt)("p",null,"Allows sorting with the order_by parameter (optional). E.g. ",(0,l.kt)("inlineCode",{parentName:"p"},"frappe.get_list('Payment Entry', filters={'docstatus': 0, 'payment_type': 'Pay'}, fields=['name', 'posting_date', 'paid_amount'], order_by='posting_date')")),(0,l.kt)("p",null,"Note that the ",(0,l.kt)("inlineCode",{parentName:"p"},"get_list")," command will return no more than 20 items by default. To increase this, use the ",(0,l.kt)("inlineCode",{parentName:"p"},"limit_page_length")," parameter. Using the ",(0,l.kt)("inlineCode",{parentName:"p"},"limit_start")," parameter allows to use pagination. In case the requested is a child table, do not forget to pass the parent parameter with the parent doctype to check permissions."),(0,l.kt)("h6",{id:"frappeget_valuedoctype-name-fieldname"},(0,l.kt)("inlineCode",{parentName:"h6"},"frappe.get_value(doctype, name, fieldname)")),(0,l.kt)("p",null,"Return a single value from the database Example: frappe.get_value('Task', 'TASK00030', 'owner')"),(0,l.kt)("h6",{id:"frappeget_last_docdoctype"},(0,l.kt)("inlineCode",{parentName:"h6"},"frappe.get_last_doc(doctype)")),(0,l.kt)("p",null,"e.g. frappe.get_last_doc('Project')"),(0,l.kt)("p",null,"Get last created document of this type."),(0,l.kt)("h6",{id:"frappeget_singledoctype"},(0,l.kt)("inlineCode",{parentName:"h6"},"frappe.get_single(doctype)")),(0,l.kt)("p",null,"e.g. frappe.get_single('Dropbox Settings')"),(0,l.kt)("p",null,"Return a ",(0,l.kt)("inlineCode",{parentName:"p"},"frappe.model.document.Document")," object of the given Single doctype.`"),(0,l.kt)("h6",{id:"frappeget_installed_apps"},(0,l.kt)("inlineCode",{parentName:"h6"},"frappe.get_installed_apps()")),(0,l.kt)("p",null,"Returns a list of all the installed apps in the current site."),(0,l.kt)("h2",{id:"document-object"},"Document Object"),(0,l.kt)("h5",{id:"load-a-document"},"Load a document"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"doc = frappe.get_doc(doctype, name)\n\n# get properties\ndoc.title\n\n# set properties to the document\ndoc.first_name = 'My Name'\n\n# save a document to the database\ndoc.save()\n")),(0,l.kt)("h3",{id:"insert-a-new-doc"},"Insert a new doc"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'doc = frappe.get_doc({\n    "doctype": "Project",\n    "title": "My new project",\n    "status": "Open"\n})\ndoc.insert()\n')),(0,l.kt)("h3",{id:"how-to-make-public-api"},"How to make public API"),(0,l.kt)("p",null,"Add ",(0,l.kt)("inlineCode",{parentName:"p"},"@frappe.whitelist()")," to the function"),(0,l.kt)("p",null,"Example: say your app name is ",(0,l.kt)("inlineCode",{parentName:"p"},"myapp"),", add this to ",(0,l.kt)("inlineCode",{parentName:"p"},"api.py")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'@frappe.whitelist()\ndef get_last_project():\n    return frappe.get_all("Project", limit_page_length = 1)[0]\n')),(0,l.kt)("p",null,"This will be accessible as ",(0,l.kt)("inlineCode",{parentName:"p"},"/api/method/myapp.api.get_last_project"),". You can call it from js like this:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'frappe.call({\n    method: "myapp.api.get_last_project",\n    callback: (response) => {\n        console.log(response.message);\n    }\n});\n')),(0,l.kt)("h3",{id:"syntax-error"},"Syntax Error"),(0,l.kt)("p",null,"You may have noticed that sometimes if there is a syntax error in your Python code and you ",(0,l.kt)("inlineCode",{parentName:"p"},"bench start"),", it fails without telling you why."),(0,l.kt)("p",null,"To find out the problem, run the following commands:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"cd ~/frappe-bench/sites\n../env/bin/python ../apps/frappe/frappe/utils/bench_helper.py\n")),(0,l.kt)("p",null,"Hopefully, you will get the correct traceback to fix your error."),(0,l.kt)("hr",null),(0,l.kt)("h1",{id:"client-side"},"Client Side"),(0,l.kt)("h2",{id:"desk"},"Desk"),(0,l.kt)("h4",{id:"globals"},"Globals"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"cur_frm"),": Current form object"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"cur_list"),": Current list object"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"cur_dialog"),": Current open dialog"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"cur_page"),": Current page object"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"frappe.quick_entry"),": Current Quick Entry object."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"locals"),": All documents and DocType loaded in the browser session. A document can be access as ",(0,l.kt)("inlineCode",{parentName:"li"},"locals[doctype][name]")," e.g. ",(0,l.kt)("inlineCode",{parentName:"li"},"locals['Opportunity']['OTY00001']"))),(0,l.kt)("h4",{id:"routing"},"Routing"),(0,l.kt)("p",null,"Routes for standard views:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"#List/[doctype]")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"#Form/[doctype]/[name]")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"#Report/[doctype]")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"#Calendar/[doctype]")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"#Tree/[doctype]")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"#modules/[module name]")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"#activity")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"#Dashboard"))),(0,l.kt)("p",null,"To change the route via js, use ",(0,l.kt)("inlineCode",{parentName:"p"},"frappe.set_route")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'frappe.set_route("List", "Customer");\n')),(0,l.kt)("h5",{id:"route-options"},"Route Options"),(0,l.kt)("p",null,"To pass values to a view, use global ",(0,l.kt)("inlineCode",{parentName:"p"},"frappe.route_options"),". ",(0,l.kt)("inlineCode",{parentName:"p"},"frappe.route_options")," is data passed to the view to whom control is being passed. For list view, it is a filter. For form, it is a default value."),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'frappe.set_route("List", "Customer", {"customer_type": "Company"});\n')),(0,l.kt)("p",null,"or"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'frappe.route_options = {"customer_type": "Company"};\nfrappe.set_route("List", "Customer");\n')),(0,l.kt)("h2",{id:"forms"},"Forms"),(0,l.kt)("p",null,"Form API"),(0,l.kt)("h3",{id:"1-to-add-a-new-handler-on-value-change"},"1. To add a new handler on value change."),(0,l.kt)("p",null,"Syntax"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"frappe.ui.form.on([DocType], {\n    [trigger]: function(frm) {\n        [function];\n    }\n});\n")),(0,l.kt)("p",null,"Replace ","[DocType]"," with the one you want to use, in quotations. Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'frappe.ui.form.on("Sales Order", {\n')),(0,l.kt)("p",null,"or"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'frappe.ui.form.on("Purchase Order", {\n')),(0,l.kt)("p",null,"in the case of a child table, the function still calls the parent doctype."),(0,l.kt)("p",null,"Replace ","[Trigger]"," with the one you want to use. Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"company: function(frm) {\n")),(0,l.kt)("p",null,"This would trigger the function when the company field is modified or"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"onload: function(frm) {\n")),(0,l.kt)("p",null,"This would trigger the function when the document is loaded."),(0,l.kt)("h4",{id:"list-of-triggers"},"List of Triggers"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Field Names (see the company example above)"),(0,l.kt)("li",{parentName:"ul"},"setup"),(0,l.kt)("li",{parentName:"ul"},"onload"),(0,l.kt)("li",{parentName:"ul"},"refresh"),(0,l.kt)("li",{parentName:"ul"},"validate"),(0,l.kt)("li",{parentName:"ul"},"on_submit"),(0,l.kt)("li",{parentName:"ul"},"onload_post_render")),(0,l.kt)("p",null,"What trigger is called when?"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Trigger"),(0,l.kt)("th",{parentName:"tr",align:null},"User > Reload"),(0,l.kt)("th",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"th"},"F5")),(0,l.kt)("th",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"th"},"Ctrl")," + ",(0,l.kt)("inlineCode",{parentName:"th"},"Shift")," + ",(0,l.kt)("inlineCode",{parentName:"th"},"R")),(0,l.kt)("th",{parentName:"tr",align:null},"New Document (first time)"),(0,l.kt)("th",{parentName:"tr",align:null},"New Document (again)"),(0,l.kt)("th",{parentName:"tr",align:null},"Menu > Reload"),(0,l.kt)("th",{parentName:"tr",align:null},"Open document (first time)"),(0,l.kt)("th",{parentName:"tr",align:null},"Open document (again)"),(0,l.kt)("th",{parentName:"tr",align:null},"Save document"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Refresh"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2713")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Onload"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Setup"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,l.kt)("td",{parentName:"tr",align:null},"\u2713"),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null}),(0,l.kt)("td",{parentName:"tr",align:null})))),(0,l.kt)("h4",{id:"child-table-triggers"},"Child Table Triggers"),(0,l.kt)("p",null,"Child Table Triggers need to be on the subtable DocType."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"fieldname_add"),(0,l.kt)("li",{parentName:"ul"},"fieldname_move"),(0,l.kt)("li",{parentName:"ul"},"before_fieldname_remove"),(0,l.kt)("li",{parentName:"ul"},"fieldname_remove")),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'frappe.ui.form.on("Salary Slip", {\n  company: function(frm) {\n    // this function is called when the value of company is changed.\n\n  }\n});\n')),(0,l.kt)("p",null,"Example for child table (e.g. in Sales Invoice custom script):"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"frappe.ui.form.on('Sales Invoice Item', {\n    items_add: function(frm) {\n      // adding a row ... \n   },\n   items_remove: function(frm) {\n      // removing a row ... \n   }\n});\n")),(0,l.kt)("h3",{id:"2-adding-standard-js-listeners-to-form-fields"},"2. Adding Standard JS Listeners to form fields"),(0,l.kt)("p",null,"Sometimes the built in triggers are not enough, so you can use standard JavaScript event listeners together with triggers to achieve better results. For a comprehensive list of listeners, check ",(0,l.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/Events"},"this site"),". The following example loads a listener once the document has been rendered and loaded. The listener runs some code when a key is pressed in the ",(0,l.kt)("inlineCode",{parentName:"p"},"customer")," field."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'frappe.ui.form.on("Sales Invoice", {\n    onload_post_render: function(frm) {\n        // This function is run right after a Sales Invoice is rendered and loaded\n        \n        // This listener is added to the customer field, listening for a keypress event\n        cur_frm.fields_dict.customer.$input.on("keypress", function(evt){\n        // Code specified here will run when a key is pressed on the customer field.\n        });\n    }\n});\n')),(0,l.kt)("h3",{id:"3-change-value-in-the-form"},"3. Change value in the form"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"frm.set_value(fieldname, value);\n")),(0,l.kt)("h3",{id:"4-talk-to-the-database"},"4. Talk to the database"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"frappe.db.get_value(doctype, filters, fieldname, callback, parent_doc)\nfrappe.db.get_single_value(doctype, field)\nfrappe.db.get_doc(doctype, name, filters = null)\nfrappe.db.get_list(doctype, {fields: [], limit: 20})\n\n// check if document already exists\nfrappe.db.exists(doctype, name)\n\n// insert a new document:\nfrappe.db.insert({\n    doctype: 'Project', \n    project_name: 'Build a decent documentation', \n    expected_end_date: '2030-02-28'\n})\n\nfrappe.db.delete_doc(doctype, name)\nfrappe.db.count(doctype, args={})\n")),(0,l.kt)("p",null,"All are asynchronous and return a promise."),(0,l.kt)("h3",{id:"5-add-a-new-row-to-a-child-table"},"5. Add a new row to a child table"),(0,l.kt)("p",null,"For example, add a new ",(0,l.kt)("inlineCode",{parentName:"p"},"Task")," 'Update Developer Cheatsheet' to every new ",(0,l.kt)("inlineCode",{parentName:"p"},"Project")," ",(0,l.kt)("em",{parentName:"p"},"on load"),". (For a list of triggers, see above.)"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"frappe.ui.form.on(\"Project\", {\n    onload: function (frm) {\n        if (frm.is_new()) {\n            frm.add_child('tasks').title = 'Update Developer Cheatsheet';\n            frm.refresh_field('tasks');\n        }\n    }\n});\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"tasks")," is the name of the child table within ",(0,l.kt)("inlineCode",{parentName:"li"},"Project")),(0,l.kt)("li",{parentName:"ul"},"we need to run ",(0,l.kt)("inlineCode",{parentName:"li"},"refresh_field")," for the new row to become visible")),(0,l.kt)("h3",{id:"filter-link-options-in-a-child-table"},"Filter link options in a child table"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"frappe.ui.form.on('{{ parent DocType }}', {\n    onload: function(frm) {\n        frm.set_query('{{ link field name }}', '{{ child table name }}', function() {\n            return {\n                'filters': {\n                    '{{ field in linked doctype }}': ['{{ operator }}', '{{ value }}']\n                }\n            };\n        });\n    },\n});\n")),(0,l.kt)("p",null,"For example, consider this snippet from ",(0,l.kt)("strong",{parentName:"p"},"Web Page")," doctype. ",(0,l.kt)("strong",{parentName:"p"},"Web Page")," contains a child table named ",(0,l.kt)("inlineCode",{parentName:"p"},"page_blocks"),", which contains a link field to ",(0,l.kt)("strong",{parentName:"p"},"Web Template"),". The following restricts the link query to show only ",(0,l.kt)("strong",{parentName:"p"},"Web Templates"),' which are not of type "Component".'),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"frappe.ui.form.on('Web Page', {\n    onload: function(frm) {\n        frm.set_query('web_template', 'page_blocks', function() {\n            return {\n                'filters': {\n                    'type': ['!=', 'Component']\n                }\n            };\n        });\n    },\n});\n")),(0,l.kt)("h2",{id:"running-tasks-serially"},"Running Tasks Serially"),(0,l.kt)("p",null,"To run tasks serially, use ",(0,l.kt)("inlineCode",{parentName:"p"},"frappe.run_serially")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"frappe.run_serially([\n  () => frappe.set_route('List', 'ToDo'),\n  () => frappe.new_doc('ToDo')\n]);\n")),(0,l.kt)("h2",{id:"tests"},"Tests"),(0,l.kt)("p",null,"To run individual test use"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"bench --site test-service run-tests --module erpnext.tests.test_woocommerce\n")),(0,l.kt)("h2",{id:"utility"},"Utility"),(0,l.kt)("p",null,"To know list of Installed Apps of a Site"))}c.isMDXComponent=!0}}]);