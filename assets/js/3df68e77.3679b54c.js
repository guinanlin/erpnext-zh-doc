"use strict";(self.webpackChunkstsinc_docs=self.webpackChunkstsinc_docs||[]).push([[5153],{3905:(e,n,r)=>{r.d(n,{Zo:()=>l,kt:()=>f});var t=r(7294);function a(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function o(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function i(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?o(Object(r),!0).forEach((function(n){a(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function s(e,n){if(null==e)return{};var r,t,a=function(e,n){if(null==e)return{};var r,t,a={},o=Object.keys(e);for(t=0;t<o.length;t++)r=o[t],n.indexOf(r)>=0||(a[r]=e[r]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)r=o[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var c=t.createContext({}),p=function(e){var n=t.useContext(c),r=n;return e&&(r="function"==typeof e?e(n):i(i({},n),e)),r},l=function(e){var n=p(e.components);return t.createElement(c.Provider,{value:n},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},m=t.forwardRef((function(e,n){var r=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),d=p(r),m=a,f=d["".concat(c,".").concat(m)]||d[m]||u[m]||o;return r?t.createElement(f,i(i({ref:n},l),{},{components:r})):t.createElement(f,i({ref:n},l))}));function f(e,n){var r=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=r.length,i=new Array(o);i[0]=m;var s={};for(var c in n)hasOwnProperty.call(n,c)&&(s[c]=n[c]);s.originalType=e,s[d]="string"==typeof e?e:a,i[1]=s;for(var p=2;p<o;p++)i[p]=r[p];return t.createElement.apply(null,i)}return t.createElement.apply(null,r)}m.displayName="MDXCreateElement"},7738:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var t=r(7462),a=(r(7294),r(3905));const o={},i=void 0,s={unversionedId:"\u5e94\u7528\u5f00\u53d1/docker\u5f00\u53d1\u73af\u5883\u642d\u5efa",id:"\u5e94\u7528\u5f00\u53d1/docker\u5f00\u53d1\u73af\u5883\u642d\u5efa",title:"docker\u5f00\u53d1\u73af\u5883\u642d\u5efa",description:"\u955c\u50cf\u514b\u9686\u5230\u672c\u5730",source:"@site/best-practice/20-\u5e94\u7528\u5f00\u53d1/20. docker\u5f00\u53d1\u73af\u5883\u642d\u5efa.md",sourceDirName:"20-\u5e94\u7528\u5f00\u53d1",slug:"/\u5e94\u7528\u5f00\u53d1/docker\u5f00\u53d1\u73af\u5883\u642d\u5efa",permalink:"/best-practice/\u5e94\u7528\u5f00\u53d1/docker\u5f00\u53d1\u73af\u5883\u642d\u5efa",draft:!1,tags:[],version:"current",sidebarPosition:20,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u6982\u5ff5\u7406\u89e3",permalink:"/best-practice/\u5e94\u7528\u5f00\u53d1/\u6982\u5ff5\u7406\u89e3"},next:{title:"Frappe.call \u8c03\u7528\u4f8b\u5b50",permalink:"/best-practice/\u5e94\u7528\u5f00\u53d1/Frappe.call \u8c03\u7528\u4f8b\u5b50"}},c={},p=[{value:"\u955c\u50cf\u514b\u9686\u5230\u672c\u5730",id:"\u955c\u50cf\u514b\u9686\u5230\u672c\u5730",level:3},{value:"\u7528dokcer\u5b89\u88c5 frappe-bench",id:"\u7528dokcer\u5b89\u88c5-frappe-bench",level:3},{value:"Install bench using docker",id:"install-bench-using-docker",level:3},{value:"Exec into the container",id:"exec-into-the-container",level:3},{value:"Install Frappe Framework and ERPNext",id:"install-frappe-framework-and-erpnext",level:3},{value:"Start supervisord",id:"start-supervisord",level:3},{value:"Stop supervisord",id:"stop-supervisord",level:3}],l={toc:p},d="wrapper";function u(e){let{components:n,...r}=e;return(0,a.kt)(d,(0,t.Z)({},l,r,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h3",{id:"\u955c\u50cf\u514b\u9686\u5230\u672c\u5730"},"\u955c\u50cf\u514b\u9686\u5230\u672c\u5730"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"docker pull frappe/bench:latest\n")),(0,a.kt)("h3",{id:"\u7528dokcer\u5b89\u88c5-frappe-bench"},"\u7528dokcer\u5b89\u88c5 frappe-bench"),(0,a.kt)("p",null,"Clone frappe_docker"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"git clone https://github.com/frappe/frappe_docker.git\ncd frappe_docker\n")),(0,a.kt)("h3",{id:"install-bench-using-docker"},"Install bench using docker"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"cp -R devcontainer-example bench\ndocker-compose -f bench/docker-compose.yml up -d\n")),(0,a.kt)("p",null,"compose\u6587\u4ef6"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'version: "3.7"\nservices:\n  mariadb:\n    image: mariadb:10.6\n    command:\n      - --character-set-server=utf8mb4\n      - --collation-server=utf8mb4_unicode_ci\n      - --skip-character-set-client-handshake\n      - --skip-innodb-read-only-compressed # Temporary fix for MariaDB 10.6\n    environment:\n      MYSQL_ROOT_PASSWORD: 123\n    volumes:\n      - mariadb-data:/var/lib/mysql\n\n  # Enable PostgreSQL only if you use it, see development/README.md for more information.\n  # postgresql:\n  #   image: postgres:11.8\n  #   environment:\n  #     POSTGRES_PASSWORD: 123\n  #   volumes:\n  #     - postgresql-data:/var/lib/postgresql/data\n\n  redis-cache:\n    image: redis:alpine\n\n  redis-queue:\n    image: redis:alpine\n\n  redis-socketio:\n    image: redis:alpine\n\n  frappe:\n    image: frappe/bench:latest\n    command: sleep infinity\n    environment:\n      - SHELL=/bin/bash\n    volumes:\n      - ..:/workspace:cached\n      # Enable if you require git cloning\n      # - ${HOME}/.ssh:/home/frappe/.ssh\n    working_dir: /workspace/development\n    ports:\n      - 8000-8005:8000-8005\n      - 9000-9005:9000-9005\n\nvolumes:\n  mariadb-data:\n  postgresql-data:\n')),(0,a.kt)("h3",{id:"exec-into-the-container"},"Exec into the container"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'docker exec -e "TERM=xterm-256color" -w /workspace/development -it bench_frappe_1 bash\n')),(0,a.kt)("h3",{id:"install-frappe-framework-and-erpnext"},"Install Frappe Framework and ERPNext"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"# Install bench for root\nsupo pip3 install -e /home/frappe/.bench\n\n# Create frappe-bench\nbench init --skip-redis-config-generation --frappe-branch version-12 frappe-bench\ncd frappe-bench\n\n# Set docker specific hosts\nbench set-mariadb-host mariadb\nbench set-redis-cache-host redis-cache:6379\nbench set-redis-queue-host redis-queue:6379\nbench set-redis-socketio-host redis-socketio:6379\n\n# Get ERPNext\nbench get-app --branch version-12 erpnext\n\n# Create new site\nbench new-site myerp.mysite.com --mariadb-root-password 123 --admin-password admin --no-mariadb-socket\n\n# Install ERPNext on site\nbench --site myerp.mysite.com install-app erpnext\n\n# Setup supervisor (includes nginx)\nbench setup supervisor --skip-redis\n\n# Symlink or copy supervisor and nginx configs\nsudo ln -s `pwd`/config/nginx.conf /etc/nginx/conf.d/frappe.conf\nsudo ln -s `pwd`/config/supervisor.conf /etc/supervisor/conf.d/frappe.conf\n# Or copy supervisor and nginx configs\nsudo cp `pwd`/config/nginx.conf /etc/nginx/conf.d/frappe.conf\nsudo cp `pwd`/config/supervisor.conf /etc/supervisor/conf.d/frappe.conf\n\n# exit container\n")),(0,a.kt)("h3",{id:"start-supervisord"},"Start supervisord"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'docker exec --user root -e "TERM=xterm-256color" -w /workspace/development -d bench_frappe_1 supervisord\n')),(0,a.kt)("h3",{id:"stop-supervisord"},"Stop supervisord"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'docker exec --user root -e "TERM=xterm-256color" -w /workspace/development -d bench_frappe_1 supervisorctl stop all\n')),(0,a.kt)("p",null,"Notes:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"publish port 80 in bench/docker-compose.yml"),(0,a.kt)("li",{parentName:"ul"},"Add volumes for ",(0,a.kt)("inlineCode",{parentName:"li"},"/etc/nginx/conf.d/")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"/etc/supervisor/conf.d/")),(0,a.kt)("li",{parentName:"ul"},"default frappe/bench:latest image does not have supervisor and nginx installed. Either install or build new image with frappe/bench as base image")))}u.isMDXComponent=!0}}]);