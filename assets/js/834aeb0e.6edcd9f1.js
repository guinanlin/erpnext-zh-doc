"use strict";(self.webpackChunkstsinc_docs=self.webpackChunkstsinc_docs||[]).push([[9550],{3905:(e,n,r)=>{r.d(n,{Zo:()=>l,kt:()=>f});var t=r(7294);function o(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function a(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function i(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?a(Object(r),!0).forEach((function(n){o(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function c(e,n){if(null==e)return{};var r,t,o=function(e,n){if(null==e)return{};var r,t,o={},a=Object.keys(e);for(t=0;t<a.length;t++)r=a[t],n.indexOf(r)>=0||(o[r]=e[r]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(t=0;t<a.length;t++)r=a[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var s=t.createContext({}),p=function(e){var n=t.useContext(s),r=n;return e&&(r="function"==typeof e?e(n):i(i({},n),e)),r},l=function(e){var n=p(e.components);return t.createElement(s.Provider,{value:n},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},m=t.forwardRef((function(e,n){var r=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),d=p(r),m=o,f=d["".concat(s,".").concat(m)]||d[m]||u[m]||a;return r?t.createElement(f,i(i({ref:n},l),{},{components:r})):t.createElement(f,i({ref:n},l))}));function f(e,n){var r=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=r.length,i=new Array(a);i[0]=m;var c={};for(var s in n)hasOwnProperty.call(n,s)&&(c[s]=n[s]);c.originalType=e,c[d]="string"==typeof e?e:o,i[1]=c;for(var p=2;p<a;p++)i[p]=r[p];return t.createElement.apply(null,i)}return t.createElement.apply(null,r)}m.displayName="MDXCreateElement"},5478:(e,n,r)=>{r.r(n),r.d(n,{contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>c,toc:()=>s});var t=r(7462),o=(r(7294),r(3905));const a={},i=void 0,c={unversionedId:"\u5e94\u7528\u5f00\u53d1/docker\u5f00\u53d1\u73af\u5883\u642d\u5efa",id:"\u5e94\u7528\u5f00\u53d1/docker\u5f00\u53d1\u73af\u5883\u642d\u5efa",isDocsHomePage:!1,title:"docker\u5f00\u53d1\u73af\u5883\u642d\u5efa",description:"\u955c\u50cf\u514b\u9686\u5230\u672c\u5730",source:"@site/best-practice/\u5e94\u7528\u5f00\u53d1/docker\u5f00\u53d1\u73af\u5883\u642d\u5efa.md",sourceDirName:"\u5e94\u7528\u5f00\u53d1",slug:"/\u5e94\u7528\u5f00\u53d1/docker\u5f00\u53d1\u73af\u5883\u642d\u5efa",permalink:"/best-practice/\u5e94\u7528\u5f00\u53d1/docker\u5f00\u53d1\u73af\u5883\u642d\u5efa",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u6700\u4f73\u5b9e\u8df5",permalink:"/best-practice/index"},next:{title:"[Custom P&L report](https://discuss.frappe.io/t/custom-p-l-report/80143)",permalink:"/best-practice/\u8d22\u52a1/\u81ea\u5b9a\u4e49PL\u62a5\u8868"}},s=[{value:"\u955c\u50cf\u514b\u9686\u5230\u672c\u5730",id:"\u955c\u50cf\u514b\u9686\u5230\u672c\u5730",children:[]},{value:"\u7528dokcer\u5b89\u88c5 frappe-bench",id:"\u7528dokcer\u5b89\u88c5-frappe-bench",children:[]},{value:"Install bench using docker",id:"install-bench-using-docker",children:[]},{value:"Exec into the container",id:"exec-into-the-container",children:[]},{value:"Install Frappe Framework and ERPNext",id:"install-frappe-framework-and-erpnext",children:[]},{value:"Start supervisord",id:"start-supervisord",children:[]},{value:"Stop supervisord",id:"stop-supervisord",children:[]}],p={toc:s},l="wrapper";function d(e){let{components:n,...r}=e;return(0,o.kt)(l,(0,t.Z)({},p,r,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h3",{id:"\u955c\u50cf\u514b\u9686\u5230\u672c\u5730"},"\u955c\u50cf\u514b\u9686\u5230\u672c\u5730"),(0,o.kt)("p",null,"docker pull frappe/bench:latest"),(0,o.kt)("h3",{id:"\u7528dokcer\u5b89\u88c5-frappe-bench"},"\u7528dokcer\u5b89\u88c5 frappe-bench"),(0,o.kt)("p",null,"Clone frappe_docker"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"git clone https://github.com/frappe/frappe_docker.git\ncd frappe_docker\n")),(0,o.kt)("h3",{id:"install-bench-using-docker"},"Install bench using docker"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"cp -R devcontainer-example bench\ndocker-compose -f bench/docker-compose.yml up -d\n")),(0,o.kt)("p",null,"compose\u6587\u4ef6"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'version: "3.7"\nservices:\n  mariadb:\n    image: mariadb:10.6\n    command:\n      - --character-set-server=utf8mb4\n      - --collation-server=utf8mb4_unicode_ci\n      - --skip-character-set-client-handshake\n      - --skip-innodb-read-only-compressed # Temporary fix for MariaDB 10.6\n    environment:\n      MYSQL_ROOT_PASSWORD: 123\n    volumes:\n      - mariadb-data:/var/lib/mysql\n\n  # Enable PostgreSQL only if you use it, see development/README.md for more information.\n  # postgresql:\n  #   image: postgres:11.8\n  #   environment:\n  #     POSTGRES_PASSWORD: 123\n  #   volumes:\n  #     - postgresql-data:/var/lib/postgresql/data\n\n  redis-cache:\n    image: redis:alpine\n\n  redis-queue:\n    image: redis:alpine\n\n  redis-socketio:\n    image: redis:alpine\n\n  frappe:\n    image: frappe/bench:latest\n    command: sleep infinity\n    environment:\n      - SHELL=/bin/bash\n    volumes:\n      - ..:/workspace:cached\n      # Enable if you require git cloning\n      # - ${HOME}/.ssh:/home/frappe/.ssh\n    working_dir: /workspace/development\n    ports:\n      - 8000-8005:8000-8005\n      - 9000-9005:9000-9005\n\nvolumes:\n  mariadb-data:\n  postgresql-data:\n')),(0,o.kt)("h3",{id:"exec-into-the-container"},"Exec into the container"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},'docker exec -e "TERM=xterm-256color" -w /workspace/development -it bench_frappe_1 bash\n')),(0,o.kt)("h3",{id:"install-frappe-framework-and-erpnext"},"Install Frappe Framework and ERPNext"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"# Install bench for root\nsupo pip3 install -e /home/frappe/.bench\n\n# Create frappe-bench\nbench init --skip-redis-config-generation --frappe-branch version-12 frappe-bench\ncd frappe-bench\n\n# Set docker specific hosts\nbench set-mariadb-host mariadb\nbench set-redis-cache-host redis-cache:6379\nbench set-redis-queue-host redis-queue:6379\nbench set-redis-socketio-host redis-socketio:6379\n\n# Get ERPNext\nbench get-app --branch version-12 erpnext\n\n# Create new site\nbench new-site myerp.mysite.com --mariadb-root-password 123 --admin-password admin --no-mariadb-socket\n\n# Install ERPNext on site\nbench --site myerp.mysite.com install-app erpnext\n\n# Setup supervisor (includes nginx)\nbench setup supervisor --skip-redis\n\n# Symlink or copy supervisor and nginx configs\nsudo ln -s `pwd`/config/nginx.conf /etc/nginx/conf.d/frappe.conf\nsudo ln -s `pwd`/config/supervisor.conf /etc/supervisor/conf.d/frappe.conf\n# Or copy supervisor and nginx configs\nsudo cp `pwd`/config/nginx.conf /etc/nginx/conf.d/frappe.conf\nsudo cp `pwd`/config/supervisor.conf /etc/supervisor/conf.d/frappe.conf\n\n# exit container\n")),(0,o.kt)("h3",{id:"start-supervisord"},"Start supervisord"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},'docker exec --user root -e "TERM=xterm-256color" -w /workspace/development -d bench_frappe_1 supervisord\n')),(0,o.kt)("h3",{id:"stop-supervisord"},"Stop supervisord"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},'docker exec --user root -e "TERM=xterm-256color" -w /workspace/development -d bench_frappe_1 supervisorctl stop all\n')),(0,o.kt)("p",null,"Notes:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"publish port 80 in bench/docker-compose.yml"),(0,o.kt)("li",{parentName:"ul"},"Add volumes for ",(0,o.kt)("inlineCode",{parentName:"li"},"/etc/nginx/conf.d/")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"/etc/supervisor/conf.d/")),(0,o.kt)("li",{parentName:"ul"},"default frappe/bench:latest image does not have supervisor and nginx installed. Either install or build new image with frappe/bench as base image")))}d.isMDXComponent=!0}}]);