"use strict";(self.webpackChunkstsinc_docs=self.webpackChunkstsinc_docs||[]).push([[3857],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>h});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},p=Object.keys(e);for(r=0;r<p.length;r++)n=p[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(r=0;r<p.length;r++)n=p[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var i=r.createContext({}),l=function(e){var t=r.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},m=function(e){var t=l(e.components);return r.createElement(i.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,p=e.originalType,i=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),c=l(n),u=a,h=c["".concat(i,".").concat(u)]||c[u]||d[u]||p;return n?r.createElement(h,o(o({ref:t},m),{},{components:n})):r.createElement(h,o({ref:t},m))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var p=n.length,o=new Array(p);o[0]=u;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s[c]="string"==typeof e?e:a,o[1]=s;for(var l=2;l<p;l++)o[l]=n[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},1003:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>o,default:()=>d,frontMatter:()=>p,metadata:()=>s,toc:()=>l});var r=n(7462),a=(n(7294),n(3905));const p={},o=void 0,s={unversionedId:"\u5b89\u88c5\u8bbe\u7f6e/\u5355\u673a\u5b89\u88c5\u6307\u4ee4",id:"\u5b89\u88c5\u8bbe\u7f6e/\u5355\u673a\u5b89\u88c5\u6307\u4ee4",title:"\u5355\u673a\u5b89\u88c5\u6307\u4ee4",description:"1. \u5982\u679c\u5f53\u524d\u767b\u5f55\u7684\u662froot\u7528\u6237\uff0c\u5c31\u8bf7\u65b0\u5efa\u4e00\u4e2a\u7528\u4e8e\u5b89\u88c5ERP\u7684sudo\u7528\u6237\u3002",source:"@site/best-practice/10. \u5b89\u88c5\u8bbe\u7f6e/30.\u5355\u673a\u5b89\u88c5\u6307\u4ee4.md",sourceDirName:"10. \u5b89\u88c5\u8bbe\u7f6e",slug:"/\u5b89\u88c5\u8bbe\u7f6e/\u5355\u673a\u5b89\u88c5\u6307\u4ee4",permalink:"/best-practice/\u5b89\u88c5\u8bbe\u7f6e/\u5355\u673a\u5b89\u88c5\u6307\u4ee4",draft:!1,tags:[],version:"current",sidebarPosition:30,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Centos\u5b89\u88c5",permalink:"/best-practice/\u5b89\u88c5\u8bbe\u7f6e/Centos\u5b89\u88c5"},next:{title:"Frappe\u73af\u5883\u5b89\u88c5\u5305",permalink:"/best-practice/\u5b89\u88c5\u8bbe\u7f6e/Frappe\u73af\u5883\u5b89\u88c5\u5305"}},i={},l=[],m={toc:l},c="wrapper";function d(e){let{components:t,...n}=e;return(0,a.kt)(c,(0,r.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u5982\u679c\u5f53\u524d\u767b\u5f55\u7684\u662froot\u7528\u6237\uff0c\u5c31\u8bf7\u65b0\u5efa\u4e00\u4e2a\u7528\u4e8e\u5b89\u88c5ERP\u7684sudo\u7528\u6237\u3002"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"adduser [frappe-user]\nusermod -aG sudo [frappe-user]\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u66f4\u65b0\u7cfb\u7edf\u5e76\u91cd\u542f\u7cfb\u7edf\u3002"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"apt update && apt upgrade -y && shutdown -r now\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u4f7f\u7528\u5b89\u88c5ERP\u6240\u5efa\u597d\u7684sudo\u7528\u6237,\u4e0b\u8f7dnode.js"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"curl -sL https://deb.nodesource.com/setup_16.x | sudo -E bash -\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u5b89\u88c5\u64cd\u4f5c\u7cfb\u7edf\u6240\u9700\u7684\u5404\u79cd\u4f9d\u8d56\u5305"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt install -y python3.10-dev python3-setuptools python3-pip python3-distutils python3.10-venv software-properties-common mariadb-server mariadb-client redis-server nodejs xvfb libfontconfig libmysqlclient-dev nginx git ansible\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u5c06Python\u7684pip\u6e90\u6539\u6210\u56fd\u5185\u6e90\uff0c\u6709\u52a9\u4e8e\u540e\u9762\u5b89\u88c5frappe\u65f6\u63d0\u9ad8\u901f\u5ea6\u548c\u6210\u529f\u7387\u3002"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"pip config set global.index-url https://mirrors.aliyun.com/pypi/simple/\npip config set install.trusted-host mirrors.aliyun.com\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u63a5\u4e0b\u6765\u5f00\u59cb\u914d\u7f6eMariaDB\uff0c\u7528nano\u7f16\u8f91my.cnf\u6587\u4ef6\u3002"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo nano /etc/mysql/my.cnf\n")),(0,a.kt)("p",{parentName:"li"},"\u5c06\u5149\u6807\u79fb\u52a8\u5230\u6700\u540e\u7a7a\u767d\u884c\uff0c\u590d\u5236\u4ee5\u4e0b\u6587\u672c\u5185\u5bb9\uff0c\u7c98\u8d34\u540e\u6ce8\u610f\u683c\u5f0f\u548c\u6362\u884c\u8981\u540c\u4e0b\u65b9\uff0cctrl + X\u8fd4\u56de\u547d\u4ee4\u884c\uff0c\u4fdd\u5b58cy.cnf\u3002"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"[mysqld]\ncharacter-set-client-handshake = FALSE \ncharacter-set-server = utf8mb4 \ncollation-server = utf8mb4_unicode_ci \n\n[mysql]\ndefault-character-set = utf8mb4\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u91cd\u542fsql"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo service mysql restart\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u5f00\u59cbmysql\u7684\u5b89\u5168\u914d\u7f6e"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"sudo mysql_secure_installation\n")),(0,a.kt)("p",{parentName:"li"},"\u7b2c\u4e00\u4e2a\u8f93\u5165\u6570\u636e\u5e93\u5bc6\u7801\u5bf9\u8bdd\u6846\u51fa\u6765\u7684\u65f6\u5019\uff0c\u76f4\u63a5\u6572\u56de\u8f66\u4ee3\u8868\u6ca1\u6709\u5bc6\u7801\uff0c\u5269\u4e0b\u7684\u6309\u7167\u4e0b\u9762\u9009\u62e9\uff1a"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# \u6ce8\uff1a\u8fd0\u884c\u7ed3\u679c\u7528 \xb7\xb7\xb7 \u4ee3\u66ff\nEnter current password for root (enter for none):  # \u8f93\u5165root(mysql)\u7684\u5bc6\u7801\uff0c\u521d\u6b21\u5b89\u88c5\u9ed8\u8ba4\u6ca1\u6709\uff0c\u76f4\u63a5\u56de\u8f66 \n ... \nSwitch to unix_socket authentication [Y/n] n # \u662f\u5426\u5207\u6362\u5230unix\u5957\u63a5\u5b57\u8eab\u4efd\u9a8c\u8bc1[Y/n]\n ... \nChange the root password? [Y/n] y #\u662f\u5426\u8bbe\u7f6eroot\u7528\u6237\u5bc6\u7801\nNew password: # \u65b0\u5bc6\u7801\nRe-enter new password:  # \u518d\u6b21\u8f93\u5165\u5bc6\u7801\n ... \nRemove anonymous users? [Y/n] y # \u662f\u5426\u5220\u9664\u533f\u540d\u7528\u6237\uff0c\u5efa\u8bae\u5220\u9664\n ... \nDisallow root login remotely? [Y/n] n # \u662f\u5426\u7981\u6b62root\u8fdc\u7a0b\u767b\u5f55\uff0c\u5efa\u8bae\u4e0d\u5f00\u542f\n ... \nRemove test database and access to it? [Y/n] n # \u662f\u5426\u5220\u9664test\u6570\u636e\u5e93\uff0c\u53ef\u4ee5\u4fdd\u7559\n...\nReload privilege tables now? [Y/n] y # \u662f\u5426\u91cd\u65b0\u52a0\u8f7d\u6743\u9650\u8868\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u56de\u8f66\n ... \nThanks for using MariaDB! # \u770b\u5230\u8fd9\u53e5\u8bdd\u8bc1\u660e\u8bbe\u7f6e\u6210\u529f\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u5b89\u88c5yarn"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo npm install -g yarn\n\n#yarn config get registry\u67e5\u770b\u6e90, \u5982\u679c\u5b98\u65b9\u6e90\u8bf7\u8bbe\u7f6e\u4e3a\u4ee5\u4e0b\u56fd\u5185\u6e90\n\nyarn config set registry https://registry.npmmirror.com/ --global  && \\\nyarn config set disturl https://npmmirror.com/package/dist --global && \\\nyarn config set sass_binary_site https://cdn.npmmirror.com/binaries/node-sass --global  && \\\nyarn config set electron_mirror https://registry.npmmirror.com/binary.html?path=electron/ --global  && \\\nyarn config set puppeteer_download_host https://registry.npmmirror.com/binary.html --global  && \\\nyarn config set chromedriver_cdnurl https://cdn.npmmirror.com/binaries/chromedriver --global  && \\\nyarn config set operadriver_cdnurl https://cdn.npmmirror.com/binaries/operadriver --global  && \\\nyarn config set phantomjs_cdnurl https://cdn.npmmirror.com/binaries/phantomjs --global  && \\\nyarn config set selenium_cdnurl https://cdn.npmmirror.com/binaries/selenium --global  && \\\nyarn config set node_inspector_cdnurl https://cdn.npmmirror.com/binaries/node-inspector --global\n\n\nnpm set registry https://registry.npmmirror.com/ && \\\nnpm set disturl https://npmmirror.com/package/dist && \\\nnpm set sass_binary_site https://cdn.npmmirror.com/binaries/node-sass && \\\nnpm set electron_mirror https://registry.npmmirror.com/binary.html?path=electron/ && \\\nnpm set puppeteer_download_host https://registry.npmmirror.com/binary.html && \\\nnpm set chromedriver_cdnurl https://cdn.npmmirror.com/binaries/chromedriver && \\\nnpm set operadriver_cdnurl https://cdn.npmmirror.com/binaries/operadriver && \\\nnpm set phantomjs_cdnurl https://cdn.npmmirror.com/binaries/phantomjs && \\\nnpm set selenium_cdnurl https://cdn.npmmirror.com/binaries/selenium && \\\nnpm set node_inspector_cdnurl https://cdn.npmmirror.com/binaries/node-inspector\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u67e5\u770b\u7248\u672c\uff0c\u5bf9\u7167\u4e00\u4e0b\uff0c\u8fd9\u4e00\u6b65\u4e0d\u505a\u4e5f\u884c."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"node -v && npm -v && python3 -V && pip3 -V && yarn -v\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u5b89\u88c5bench\uff0c\u5373erpnext\u7cfb\u7edf\u7684\u547d\u4ee4\u884c\u7ba1\u7406\u5de5\u5177\uff0c\u7c7b\u4f3cwindows\u7cfb\u7edf\u7684\u7a0b\u5e8f\u7ba1\u7406\u5668\u3002"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo -H pip3 install frappe-bench\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u4f7f\u7528bench\u547d\u4ee4\u5b89\u88c5frappe\u6846\u67b6\u3002frappe-bench\u662f\u5b89\u88c5frappe\u6846\u67b6\u7684\u76ee\u5f55\u540d\u79f0\u3002"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"bench init --frappe-branch version-14 frappe-bench --frappe-path=https://gitee.com/mirrors/frappe --verbose\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u518d\u5c06\u5b89\u88c5\u7684\u7cfb\u7edf\u7528\u6237\u5206\u914d\u4e00\u4e0b\u6267\u884c\u6743\u9650\u3002"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"chmod -R o+rx /home/[frappe-user]/\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u8fdb\u5165bench\u76ee\u5f55"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"cd frappe-bench\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u65b0\u5efa\u7ad9\u70b9\uff0c\u4e0b\u9762\u662f\u4ee5erpnext\u4f5c\u4e3a\u7ad9\u70b9\u540d\u79f0\u3002"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"bench new-site erpnext\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u8bbe\u7f6e\u4e3a\u751f\u4ea7\u73af\u5883\uff0c\u5373\u7528supervisorctl\u7ba1\u7406\u6240\u6709\u8fdb\u7a0b\uff0c\u4f7f\u7528nginx\u505a\u53cd\u5411\u4ee3\u7406\u3002\u5982\u679c\u5b89\u88c5\u53ea\u662f\u4e3a\u4e86\u505a\u5f00\u53d1\uff0c\u53ef\u4ee5\u8df3\u8fc7\u8fd9\u4e00\u6b65\u3002bench start"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo bench setup production {USERNAME}\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u4e0b\u8f7dapp"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"bench get-app https://gitee.com/phipsoft/payments\nbench get-app --branch version-14 erpnext https://gitee.com/mirrors/erpnext \nbench get-app --branch version-14 https://gitee.com/phipsoft/hrms  \n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u5b89\u88c5app"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"bench --site {sitename} install-app payments\nbench --site {sitename} install-app erpnext\nbench --site {sitename} install-app hrms\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u5b89\u88c5\u5b8c\u540e\u53ef\u67e5\u770b\u4e00\u4e0b\u662f\u5426\u6709\u6d3b\u52a8\u7684wokers\uff0c\u540c\u6837\u7684\uff0c\u5982\u679c\u6ca1\u5f00\u542f\u751f\u4ea7\u73af\u5883\uff0c\u8fd9\u4e00\u6b65\u4e5f\u53ef\u4ee5\u7565\u8fc7\u3002"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"bench doctor\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u67e5\u770b\u6240\u9700\u7684app\u662f\u5426\u5b89\u88c5\u6b63\u786e\uff0c\u53ef\u4ee5\u7528\u8fd9\u4e2a\u547d\u4ee4"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"bench version\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\u6700\u540e\u89e3\u51b3\u53ef\u80fd\u5b58\u5728PDF\u6253\u5370\u4e2d\u6587\u663e\u793a\u4e71\u7801\u6240\u9700\u8981\u7684\u5de5\u5177"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"wget https://gitee.com/qinyanwan/erpnext/releases/download/v13.29.0/wkhtmltox_0.12.6.1-2.jammy_amd64.deb\n")),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo dpkg -i wkhtmltox_0.12.6.1-2.jammy_amd64.deb\n")),(0,a.kt)("p",{parentName:"li"},"\u5982\u679c\u5b89\u88c5\u63d0\u793a\u6709\u7f3a\u5c11\u4f9d\u8d56\u7684\u9519\u8bef\uff0c\u6267\u884c\u4e0b\u9762\u547d\u4ee4\u3002"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt -f install\n")),(0,a.kt)("p",{parentName:"li"},"\u73b0\u5728\uff0c\u6211\u4eec\u53ef\u4ee5\u68c0\u67e5wkhtmltopdf \u5e93\u662f\u5426\u6b63\u786e\u5b89\u88c5\u5e76\u786e\u8ba4\u662f\u5426\u4e3a\u6240\u9700\u7248\u672c\uff1a"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"wkhtmltopdf \u2013version\n")),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"\u663e\u793awkhtmltopdf 0.12.6 (with patched qt)\u5373\u662f\u6b63\u786e\u7248\u672c")))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5176\u4ed6")),(0,a.kt)("p",null,"\u6c49\u5316\u3001\u672c\u5730\u5316\u8bf7\u767b\u5f55",(0,a.kt)("a",{parentName:"p",href:"https://gitee.com/yuzelin/%E6%8C%89%E9%9C%80%E5%AE%89%E8%A3%85%E7%9B%B8%E5%85%B3APP%E3%80%82"},"https://gitee.com/yuzelin/\u6309\u9700\u5b89\u88c5\u76f8\u5173APP\u3002")))}d.isMDXComponent=!0}}]);