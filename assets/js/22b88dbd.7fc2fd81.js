"use strict";(self.webpackChunkstsinc_docs=self.webpackChunkstsinc_docs||[]).push([[6782],{3905:(e,t,r)=>{r.d(t,{Zo:()=>d,kt:()=>u});var a=r(7294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var m=a.createContext({}),s=function(e){var t=a.useContext(m),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},d=function(e){var t=s(e.components);return a.createElement(m.Provider,{value:t},e.children)},p="mdxType",f={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,o=e.originalType,m=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),p=s(r),c=n,u=p["".concat(m,".").concat(c)]||p[c]||f[c]||o;return r?a.createElement(u,l(l({ref:t},d),{},{components:r})):a.createElement(u,l({ref:t},d))}));function u(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=r.length,l=new Array(o);l[0]=c;var i={};for(var m in t)hasOwnProperty.call(t,m)&&(i[m]=t[m]);i.originalType=e,i[p]="string"==typeof e?e:n,l[1]=i;for(var s=2;s<o;s++)l[s]=r[s];return a.createElement.apply(null,l)}return a.createElement.apply(null,r)}c.displayName="MDXCreateElement"},8017:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>m,contentTitle:()=>l,default:()=>f,frontMatter:()=>o,metadata:()=>i,toc:()=>s});var a=r(7462),n=(r(7294),r(3905));const o={},l="Form \u8868\u5355\u811a\u672c",i={unversionedId:"JS \u5ba2\u6237\u7aefAPI/From\u8868\u5355\u811a\u672c",id:"JS \u5ba2\u6237\u7aefAPI/From\u8868\u5355\u811a\u672c",title:"Form \u8868\u5355\u811a\u672c",description:"Form Scripts lets you add client side logic to your Forms. You can write Form Scripts for automatically fetching values, adding validation or adding contextual actions to your Form.",source:"@site/resource-center/40. JS \u5ba2\u6237\u7aefAPI/10. From\u8868\u5355\u811a\u672c.md",sourceDirName:"40. JS \u5ba2\u6237\u7aefAPI",slug:"/JS \u5ba2\u6237\u7aefAPI/From\u8868\u5355\u811a\u672c",permalink:"/resource-center/JS \u5ba2\u6237\u7aefAPI/From\u8868\u5355\u811a\u672c",draft:!1,tags:[],version:"current",sidebarPosition:10,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u5b98\u65b9Framework\u57f9\u8bad\u5927\u7eb2",permalink:"/resource-center/\u57f9\u8bad/\u5b98\u65b9Framework\u57f9\u8bad\u5927\u7eb2"},next:{title:"Document API",permalink:"/resource-center/Python\u670d\u52a1\u5668\u7aefAPI/Document API"}},m={},s=[{value:"Standard Form Scripts ",id:"standard-form-scripts-",level:2},{value:"Child Table Scripts ",id:"child-table-scripts-",level:3},{value:"Custom Form Scripts ",id:"custom-form-scripts-",level:2},{value:"Form Events ",id:"form-events-",level:2},{value:"Child Table Events ",id:"child-table-events-",level:3},{value:"Form API ",id:"form-api-",level:2},{value:"frm.set_value ",id:"frmset_value-",level:3},{value:"frm.refresh ",id:"frmrefresh-",level:3},{value:"frm.save ",id:"frmsave-",level:3},{value:"frm.enable_save / frm.disable_save ",id:"frmenable_save--frmdisable_save-",level:3},{value:"frm.email_doc ",id:"frmemail_doc-",level:3},{value:"frm.reload_doc ",id:"frmreload_doc-",level:3},{value:"frm.refresh_field ",id:"frmrefresh_field-",level:3},{value:"frm.is_dirty ",id:"frmis_dirty-",level:3},{value:"frm.dirty ",id:"frmdirty-",level:3},{value:"frm.is_new ",id:"frmis_new-",level:3},{value:"frm.set_intro ",id:"frmset_intro-",level:3},{value:"frm.add_custom_button ",id:"frmadd_custom_button-",level:3},{value:"frm.change_custom_button_type ",id:"frmchange_custom_button_type-",level:3},{value:"frm.remove_custom_button ",id:"frmremove_custom_button-",level:3},{value:"frm.clear_custom_buttons ",id:"frmclear_custom_buttons-",level:3},{value:"frm.set_df_property ",id:"frmset_df_property-",level:3},{value:"frm.toggle_enable ",id:"frmtoggle_enable-",level:3},{value:"frm.toggle_reqd ",id:"frmtoggle_reqd-",level:3},{value:"frm.toggle_display ",id:"frmtoggle_display-",level:3},{value:"frm.set_query ",id:"frmset_query-",level:3},{value:"frm.add_child ",id:"frmadd_child-",level:3},{value:"frm.call ",id:"frmcall-",level:3},{value:"frm.trigger ",id:"frmtrigger-",level:3},{value:"frm.get_selected ",id:"frmget_selected-",level:3},{value:"frm.ignore_doctypes_on_cancel_all ",id:"frmignore_doctypes_on_cancel_all-",level:3}],d={toc:s},p="wrapper";function f(e){let{components:t,...r}=e;return(0,n.kt)(p,(0,a.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"form-\u8868\u5355\u811a\u672c"},"Form \u8868\u5355\u811a\u672c"),(0,n.kt)("p",null,"Form Scripts lets you add client side logic to your Forms. You can write Form Scripts for automatically fetching values, adding validation or adding contextual actions to your Form."),(0,n.kt)("h2",{id:"standard-form-scripts-"},"Standard Form Scripts",(0,n.kt)("a",{parentName:"h2",href:"https://frappeframework.com/docs/user/en/api/form#standard-form-scripts"}," ")),(0,n.kt)("p",null,"When you create a new DocType, a ",(0,n.kt)("inlineCode",{parentName:"p"},"{doctype}.js")," is created where you can write your form script."),(0,n.kt)("p",null,"Syntax:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"frappe.ui.form.on(doctype, {\n    event1() {\n        // handle event 1\n    },\n    event2() {\n        // handle event 2\n    }\n})\n")),(0,n.kt)("p",null,"For example, ",(0,n.kt)("inlineCode",{parentName:"p"},"todo.js")," which is located at ",(0,n.kt)("inlineCode",{parentName:"p"},"frappe/desk/doctype/todo/todo.js")," may look like this:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"// Script for ToDo Form\nfrappe.ui.form.on('ToDo', {\n    // on refresh event\n    refresh(frm) {\n        // if reference_type and reference_name are set,\n        // add a custom button to go to the reference form\n        if (frm.doc.reference_type &amp;&amp; frm.doc.reference_name) {\n            frm.add_custom_button(__(frm.doc.reference_name), () => {\n                frappe.set_route(\"Form\", frm.doc.reference_type, frm.doc.reference_name);\n            });\n        }\n    }\n})\n")),(0,n.kt)("h3",{id:"child-table-scripts-"},"Child Table Scripts",(0,n.kt)("a",{parentName:"h3",href:"https://frappeframework.com/docs/user/en/api/form#child-table-scripts"}," ")),(0,n.kt)("p",null,"Child Table Scripts should be written in the same file as their parent."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"frappe.ui.form.on('Quotation', {\n    // ...\n})\n\nfrappe.ui.form.on('Quotation Item', {\n    // cdt is Child DocType name i.e Quotation Item\n    // cdn is the row name for e.g bbfcb8da6a\n    item_code(frm, cdt, cdn) {\n        let row = frappe.get_doc(cdt, cdn);\n    }\n})\n")),(0,n.kt)("h2",{id:"custom-form-scripts-"},"Custom Form Scripts",(0,n.kt)("a",{parentName:"h2",href:"https://frappeframework.com/docs/user/en/api/form#custom-form-scripts"}," ")),(0,n.kt)("p",null,"You can also write form scripts by creating ",(0,n.kt)("strong",{parentName:"p"},"Client Script")," in the system. You should write Client Scripts if the logic is specific to your site. If you want to share Form Scripts across sites, you must include them via Apps."),(0,n.kt)("p",null,"To create a new Client Script, go to"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Home > Customization > Client Script > New")),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://frappeframework.com/files/client-script-form.png",alt:"New Client Script"}),(0,n.kt)("em",{parentName:"p"},"New Client Script for Form")),(0,n.kt)("h2",{id:"form-events-"},"Form Events",(0,n.kt)("a",{parentName:"h2",href:"https://frappeframework.com/docs/user/en/api/form#form-events"}," ")),(0,n.kt)("p",null,"Form Scripts depend on events to trigger. Here are the list of all Form Events that are triggered by Form."),(0,n.kt)("p",null,"These events will get ",(0,n.kt)("inlineCode",{parentName:"p"},"frm")," as the first parameter in their handler functions."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"frappe.ui.form.on('ToDo', {\n    // frm passed as the first parameter\n    setup(frm) {\n        // write setup code\n    }\n})\n")),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:"left"},"Event Name"),(0,n.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"setup")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Triggered once when the form is created for the first time")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"before_load")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Triggered before the form is about to load")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"onload")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Triggered when the form is loaded and is about to render")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"refresh")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Triggered when the form is loaded and rendered.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"onload_post_render")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Triggered after the form is loaded and rendered")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"validate")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Triggered before before_save")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"before_save")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Triggered before save is called")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"after_save")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Triggered after form is saved")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"before_submit")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Triggered before submit is called")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"on_submit")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Triggered after form is submitted")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"before_cancel")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Triggered before cancel is called")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"after_cancel")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Triggered after form is cancelled")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"timeline_refresh")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Triggered after form timeline is rendered")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"{fieldname}_on_form_rendered")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Triggered when a row is opened as a form in a Table field")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"{fieldname}")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Triggered when the value of fieldname is changed")))),(0,n.kt)("h3",{id:"child-table-events-"},"Child Table Events",(0,n.kt)("a",{parentName:"h3",href:"https://frappeframework.com/docs/user/en/api/form#child-table-events"}," ")),(0,n.kt)("p",null,"These events are triggered in the context of a Child Table. Hence, along with ",(0,n.kt)("inlineCode",{parentName:"p"},"frm"),", they will also get the ",(0,n.kt)("inlineCode",{parentName:"p"},"cdt")," (Child DocType) and ",(0,n.kt)("inlineCode",{parentName:"p"},"cdn")," (Child Docname) parameters in their handler functions."),(0,n.kt)("p",null,'Imagine our "ToDo" DocType has a field called "links" that contains a Child Table. This Child Table is defined in a DocType called "Dynamic Link". We want our code to run whenever a row is added to the table.'),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"// this code is located inside `todo.js`\n\nfrappe.ui.form.on('Dynamic Link', { // The child table is defined in a DoctType called \"Dynamic Link\"\n    links_add(frm, cdt, cdn) { // \"links\" is the name of the table field in ToDo, \"_add\" is the event\n        // frm: current ToDo form\n        // cdt: child DocType 'Dynamic Link'\n        // cdn: child docname (something like 'a6dfk76')\n        // cdt and cdn are useful for identifying which row triggered this event\n\n        frappe.msgprint('A row has been added to the links table \ud83c\udf89 ');\n    }\n});\n")),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:"left"},"Event Name"),(0,n.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"before_{fieldname}_remove")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Triggered when a row is about to be removed from a Table field")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"{fieldname}_add")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Triggered when a row is added to a Table field")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"{fieldname}_remove")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Triggered when a row is removed from a Table field")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"{fieldname}_move")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Triggered when a row is reordered to another location in a Table field")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("inlineCode",{parentName:"td"},"form_render")),(0,n.kt)("td",{parentName:"tr",align:"left"},"Triggered when a row is opened as a form in a Table field")))),(0,n.kt)("h2",{id:"form-api-"},"Form API",(0,n.kt)("a",{parentName:"h2",href:"https://frappeframework.com/docs/user/en/api/form#form-api"}," ")),(0,n.kt)("p",null,"Here are a list of common methods that are available on the ",(0,n.kt)("inlineCode",{parentName:"p"},"frm")," object."),(0,n.kt)("h3",{id:"frmset_value-"},"frm.set_value",(0,n.kt)("a",{parentName:"h3",href:"https://frappeframework.com/docs/user/en/api/form#frm-set-value"}," ")),(0,n.kt)("p",null,"Set the value of a field. This will trigger the field change event in the form."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"// set a single value\nfrm.set_value('description', 'New description')\n\n// set multiple values at once\nfrm.set_value({\n    status: 'Open',\n    description: 'New description'\n})\n\n// returns a promise\nfrm.set_value('description', 'New description')\n    .then(() => {\n        // do something after value is set\n    })\n")),(0,n.kt)("h3",{id:"frmrefresh-"},"frm.refresh",(0,n.kt)("a",{parentName:"h3",href:"https://frappeframework.com/docs/user/en/api/form#frm-refresh"}," ")),(0,n.kt)("p",null,"Refresh the form with the latest values from the server. Will trigger ",(0,n.kt)("inlineCode",{parentName:"p"},"before_load"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"onload"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"refresh"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"timeline_refresh")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"onload_post_render"),"."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"frm.refresh();\n")),(0,n.kt)("h3",{id:"frmsave-"},"frm.save",(0,n.kt)("a",{parentName:"h3",href:"https://frappeframework.com/docs/user/en/api/form#frm-save"}," ")),(0,n.kt)("p",null,"Trigger form save. Will trigger ",(0,n.kt)("inlineCode",{parentName:"p"},"validate"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"before_save"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"after_save"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"timeline_refresh")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"refresh"),"."),(0,n.kt)("p",null,"It can be used to trigger other save actions like Submit, Cancel and Update. In that case, the relevant events will be triggered."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"// save form\nfrm.save();\n\n// submit form\nfrm.save('Submit');\n\n// cancel form\nfrm.save('Cancel');\n\n// update form (after submit)\nfrm.save('Update');\n\n// all methods returns a promise\n")),(0,n.kt)("h3",{id:"frmenable_save--frmdisable_save-"},"frm.enable_save / frm.disable_save",(0,n.kt)("a",{parentName:"h3",href:"https://frappeframework.com/docs/user/en/api/form#frm-enable-save-frm-disable-save"}," ")),(0,n.kt)("p",null,"Methods to enable / disable the Save button in the form."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"if (frappe.user_roles.includes('Custom Role')) {\n    frm.enable_save();\n} else {\n    frm.disable_save();\n}\n")),(0,n.kt)("h3",{id:"frmemail_doc-"},"frm.email_doc",(0,n.kt)("a",{parentName:"h3",href:"https://frappeframework.com/docs/user/en/api/form#frm-email-doc"}," ")),(0,n.kt)("p",null,"Open Email dialog for this form."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"// open email dialog\nfrm.email_doc();\n\n// open email dialog with some message\nfrm.email_doc(`Hello ${frm.doc.customer_name}`);\n")),(0,n.kt)("h3",{id:"frmreload_doc-"},"frm.reload_doc",(0,n.kt)("a",{parentName:"h3",href:"https://frappeframework.com/docs/user/en/api/form#frm-reload-doc"}," ")),(0,n.kt)("p",null,"Reload document with the latest values from the server and call ",(0,n.kt)("inlineCode",{parentName:"p"},"frm.refresh()"),"."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"frm.reload_doc();\n")),(0,n.kt)("h3",{id:"frmrefresh_field-"},"frm.refresh_field",(0,n.kt)("a",{parentName:"h3",href:"https://frappeframework.com/docs/user/en/api/form#frm-refresh-field"}," ")),(0,n.kt)("p",null,"Refresh the field and it's dependencies."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"frm.refresh_field('description');\n")),(0,n.kt)("h3",{id:"frmis_dirty-"},"frm.is_dirty",(0,n.kt)("a",{parentName:"h3",href:"https://frappeframework.com/docs/user/en/api/form#frm-is-dirty"}," ")),(0,n.kt)("p",null,"\u8868\u5355\u7684\u503c\u662f\u5426\u5df2\u7ecf\u6539\u53d8\uff0c \u5e76\u4e14\u8fd8\u6ca1\u6709\u4fdd\u5b58\u3002"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"if (frm.is_dirty()) {\n    frappe.show_alert('Please save form before attaching a file')\n}\n")),(0,n.kt)("h3",{id:"frmdirty-"},"frm.dirty",(0,n.kt)("a",{parentName:"h3",href:"https://frappeframework.com/docs/user/en/api/form#frm-dirty"}," ")),(0,n.kt)("p",null,"\u8bbe\u7f6e\u8868\u5355\u4e3a\u201cdirty\u201d\u3002 \u4e3b\u8981\u7528\u4e8e\u8bbe\u7f6e\u8868\u5355\u7684\u503c\u5df2\u7ecf\u88ab\u6539\u53d8\u3002 \u8fd9\u4e2a\u5c06\u89e6\u53d1 ",(0,n.kt)("em",{parentName:"p"},"\u201cNot Saved\u201d")," \u3002"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"frm.doc.browser_data = navigator.appVersion;\nfrm.dirty();\nfrm.save();\n")),(0,n.kt)("p",null,"Calling save without setting the form dirty will trigger a ",(0,n.kt)("strong",{parentName:"p"},'*"No changes in document"',"*")," toast."),(0,n.kt)("h3",{id:"frmis_new-"},"frm.is_new",(0,n.kt)("a",{parentName:"h3",href:"https://frappeframework.com/docs/user/en/api/form#frm-is-new"}," ")),(0,n.kt)("p",null,"Check if the form is new and is not saved yet."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"// add custom button only if form is not new\nif (!frm.is_new()) {\n    frm.add_custom_button('Click me', () => console.log('Clicked custom button'))\n}\n")),(0,n.kt)("h3",{id:"frmset_intro-"},"frm.set_intro",(0,n.kt)("a",{parentName:"h3",href:"https://frappeframework.com/docs/user/en/api/form#frm-set-intro"}," ")),(0,n.kt)("p",null,"Set intro text on the top of the form. The function takes two parameters: ",(0,n.kt)("inlineCode",{parentName:"p"},"message")," (string, required) and ",(0,n.kt)("inlineCode",{parentName:"p"},"color")," (string, optional)."),(0,n.kt)("p",null,"Color can be 'blue', 'red', 'orange', 'green' or 'yellow'. Default is blue."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"if (!frm.doc.description) {\n    frm.set_intro('Please set the value of description', 'blue');\n}\n")),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://frappeframework.com/files/Screenshot%202022-04-23%20at%201.56.04%20AM.png",alt:"Intro text example"}),(0,n.kt)("em",{parentName:"p"},"Intro Text Example")),(0,n.kt)("h3",{id:"frmadd_custom_button-"},"frm.add_custom_button",(0,n.kt)("a",{parentName:"h3",href:"https://frappeframework.com/docs/user/en/api/form#frm-add-custom-button"}," ")),(0,n.kt)("p",null,"Add a custom button in the inner toolbar of the page. Alias to ",(0,n.kt)("a",{parentName:"p",href:"https://frappeframework.com/docs/v14/user/en/api/page#pageadd_inner_button"},"page.add_inner_button"),"."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"// Custom buttons\nfrm.add_custom_button('Open Reference form', () => {\n    frappe.set_route('Form', frm.doc.reference_type, frm.doc.reference_name);\n})\n\n// Custom buttons in groups\nfrm.add_custom_button('Closed', () => {\n    frm.doc.status = 'Closed'\n}, 'Set Status');\n")),(0,n.kt)("h3",{id:"frmchange_custom_button_type-"},"frm.change_custom_button_type",(0,n.kt)("a",{parentName:"h3",href:"https://frappeframework.com/docs/user/en/api/form#frm-change-custom-button-type"}," ")),(0,n.kt)("p",null,"Change a specific custom button type by label (and group)."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"// change type of ungrouped button\nfrm.change_custom_button_type('Open Reference form', null, 'primary');\n\n// change type of a button in a group\nfrm.change_custom_button_type('Closed', 'Set Status', 'danger');\n")),(0,n.kt)("h3",{id:"frmremove_custom_button-"},"frm.remove_custom_button",(0,n.kt)("a",{parentName:"h3",href:"https://frappeframework.com/docs/user/en/api/form#frm-remove-custom-button"}," ")),(0,n.kt)("p",null,"Remove a specific custom button by label (and group)."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"// remove custom button\nfrm.remove_custom_button('Open Reference form');\n\n// remove custom button in a group\nfrm.remove_custom_button('Closed', 'Set Status');\n")),(0,n.kt)("h3",{id:"frmclear_custom_buttons-"},"frm.clear_custom_buttons",(0,n.kt)("a",{parentName:"h3",href:"https://frappeframework.com/docs/user/en/api/form#frm-clear-custom-buttons"}," ")),(0,n.kt)("p",null,"Remove all custom buttons from the inner toolbar."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"frm.clear_custom_buttons();\n")),(0,n.kt)("h3",{id:"frmset_df_property-"},"frm.set_df_property",(0,n.kt)("a",{parentName:"h3",href:"https://frappeframework.com/docs/user/en/api/form#frm-set-df-property"}," ")),(0,n.kt)("p",null,"Change the docfield property of a field and refresh the field."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"// change the fieldtype of description field to Text\nfrm.set_df_property('description', 'fieldtype', 'Text');\n\n// set the options of the status field to only be [Open, Closed]\nfrm.set_df_property('status', 'options', ['Open', 'Closed'])\n\n// set a field as mandatory\nfrm.set_df_property('title', 'reqd', 1)\n\n// set a field as read only\nfrm.set_df_property('status', 'read_only', 1)\n")),(0,n.kt)("h3",{id:"frmtoggle_enable-"},"frm.toggle_enable",(0,n.kt)("a",{parentName:"h3",href:"https://frappeframework.com/docs/user/en/api/form#frm-toggle-enable"}," ")),(0,n.kt)("p",null,"Toggle a field or list of fields as ",(0,n.kt)("inlineCode",{parentName:"p"},"read_only")," based on a condition."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"// set status and priority as read_only\n// if user does not have System Manager role\nlet is_allowed = frappe.user_roles.includes('System Manager');\nfrm.toggle_enable(['status', 'priority'], is_allowed);\n")),(0,n.kt)("h3",{id:"frmtoggle_reqd-"},"frm.toggle_reqd",(0,n.kt)("a",{parentName:"h3",href:"https://frappeframework.com/docs/user/en/api/form#frm-toggle-reqd"}," ")),(0,n.kt)("p",null,"Toggle a field or list of fields as mandatory (",(0,n.kt)("inlineCode",{parentName:"p"},"reqd"),") based on a condition."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"// set priority as mandatory\n// if status is Open\nfrm.toggle_reqd('priority', frm.doc.status === 'Open');\n")),(0,n.kt)("h3",{id:"frmtoggle_display-"},"frm.toggle_display",(0,n.kt)("a",{parentName:"h3",href:"https://frappeframework.com/docs/user/en/api/form#frm-toggle-display"}," ")),(0,n.kt)("p",null,"Show/hide a field or list of fields based on a condition."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"// show priority and due_date field\n// if status is Open\nfrm.toggle_display(['priority', 'due_date'], frm.doc.status === 'Open');\n")),(0,n.kt)("h3",{id:"frmset_query-"},"frm.set_query",(0,n.kt)("a",{parentName:"h3",href:"https://frappeframework.com/docs/user/en/api/form#frm-set-query"}," ")),(0,n.kt)("p",null,"Apply filters on a Link field to show limited records to choose from. You must call ",(0,n.kt)("inlineCode",{parentName:"p"},"frm.set_query")," very early in the form lifecycle, usually in ",(0,n.kt)("inlineCode",{parentName:"p"},"setup")," or ",(0,n.kt)("inlineCode",{parentName:"p"},"onload"),"."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"// show only customers whose territory is set to India\nfrm.set_query('customer', () => {\n    return {\n        filters: {\n            territory: 'India'\n        }\n    }\n})\n\n// show customers whose territory is any of India, Nepal, Japan\nfrm.set_query('customer', () => {\n    return {\n        filters: {\n            territory: ['in', ['India', 'Nepal', 'Japan']]\n        }\n    }\n})\n\n// set filters for Link field item_code in\n// items field which is a Child Table\nfrm.set_query('item_code', 'items', () => {\n    return {\n        filters: {\n            item_group: 'Products'\n        }\n    }\n})\n")),(0,n.kt)("p",null,"You can also override the filter method and provide your own custom method on the server side. Just the set the query to the module path of your python method."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"// change the filter method by passing a custom method\nfrm.set_query('fieldname', () => {\n    return {\n        query: 'dotted.path.to.custom.custom_query',\n        filters: {\n            field1: 'value1'\n        }\n    }\n})\n# python method signature\ndef custom_query(doctype, txt, searchfield, start, page_len, filters):\n    # your logic\n    return filtered_list\n")),(0,n.kt)("h3",{id:"frmadd_child-"},"frm.add_child",(0,n.kt)("a",{parentName:"h3",href:"https://frappeframework.com/docs/user/en/api/form#frm-add-child"}," ")),(0,n.kt)("p",null,"Add a row with values to a Table field."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"let row = frm.add_child('items', {\n    item_code: 'Tennis Racket',\n    qty: 2\n});\n\nfrm.refresh_field('items');\n")),(0,n.kt)("h3",{id:"frmcall-"},"frm.call",(0,n.kt)("a",{parentName:"h3",href:"https://frappeframework.com/docs/user/en/api/form#frm-call"}," ")),(0,n.kt)("p",null,"Call a server side controller method with arguments."),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},(0,n.kt)("strong",{parentName:"p"},"Note:")," While accessing any server side method using ",(0,n.kt)("inlineCode",{parentName:"p"},"frm.call()"),", you need to whitelist such method using the ",(0,n.kt)("inlineCode",{parentName:"p"},"@frappe.whitelist")," decorator.")),(0,n.kt)("p",null,"For the following controller code:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-py"},"class ToDo(Document):\n    @frappe.whitelist()\n    def get_linked_doc(self, throw_if_missing=False):\n        if not frappe.db.exists(self.reference_type, self.reference_name):\n            if throw_if_missing:\n                frappe.throw('Linked document not found')\n\n        return frappe.get_doc(self.reference_type, self.reference_name)\n")),(0,n.kt)("p",null,"You can call it from client using ",(0,n.kt)("inlineCode",{parentName:"p"},"frm.call"),"."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"frm.call('get_linked_doc', { throw_if_missing: true })\n    .then(r => {\n        if (r.message) {\n            let linked_doc = r.message;\n            // do something with linked_doc\n        }\n    })\n")),(0,n.kt)("h3",{id:"frmtrigger-"},"frm.trigger",(0,n.kt)("a",{parentName:"h3",href:"https://frappeframework.com/docs/user/en/api/form#frm-trigger"}," ")),(0,n.kt)("p",null,"Trigger any form event explicitly."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"frappe.ui.form.on('ToDo', {\n    refresh(frm) {\n        frm.trigger('set_mandatory_fields');\n    },\n\n    set_mandatory_fields(frm) {\n        frm.toggle_reqd('priority', frm.doc.status === 'Open');\n    }\n})\n")),(0,n.kt)("h3",{id:"frmget_selected-"},"frm.get_selected",(0,n.kt)("a",{parentName:"h3",href:"https://frappeframework.com/docs/user/en/api/form#frm-get-selected"}," ")),(0,n.kt)("p",null,"Get selected rows in Child Tables in an object where key is the table fieldname and values are row names."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},'let selected = frm.get_selected()\nconsole.log(selected)\n// {\n//  items: ["bbfcb8da6a", "b1f1a43233"]\n//  taxes: ["036ab9452a"]\n// }\n')),(0,n.kt)("h3",{id:"frmignore_doctypes_on_cancel_all-"},"frm.ignore_doctypes_on_cancel_all",(0,n.kt)("a",{parentName:"h3",href:"https://frappeframework.com/docs/user/en/api/form#frm-ignore-doctypes-on-cancel-all"}," ")),(0,n.kt)("p",null,"To avoid cancellation of linked documents during cancel all, you need to set the ",(0,n.kt)("inlineCode",{parentName:"p"},"frm.ignored_doctypes_on_cancel_all")," property with an array of DocTypes of linked documents."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},'frappe.ui.form.on("DocType 1", {\n    onload: function(frm) {\n        // Ignore cancellation for all linked documents of respective DocTypes.\n        frm.ignore_doctypes_on_cancel_all = ["DocType 2", "DocType 3"];\n    }\n}\n')),(0,n.kt)("p",null,"In the above example, the system will avoid cancellation for all documents of 'DocType 2' and 'DocType 3' which are linked with document of 'DocType 1' during cancellation."))}f.isMDXComponent=!0}}]);